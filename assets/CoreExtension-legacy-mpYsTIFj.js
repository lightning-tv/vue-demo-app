!function(){function t(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,a,o=[],h=!0,u=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=s.call(r)).done)&&(o.push(i.value),o.length!==e);h=!0);}catch(t){u=!0,n=t}finally{try{if(!h&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return o}}(t,r)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,r):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function r(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return e};var t,e={},i=Object.prototype,n=i.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,r){return t[e]=r}}function c(t,e,r,i){var n=e&&e.prototype instanceof T?e:T,a=Object.create(n.prototype),o=new U(i||[]);return s(a,"_invoke",{value:S(t,r,o)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var f="suspendedStart",g="suspendedYield",v="executing",p="completed",E={};function T(){}function x(){}function _(){}var m={};d(m,o,(function(){return this}));var R=Object.getPrototypeOf,A=R&&R(R(N([])));A&&A!==i&&n.call(A,o)&&(m=A);var b=_.prototype=T.prototype=Object.create(m);function y(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(i,s,a,o){var h=l(t[i],t,s);if("throw"!==h.type){var u=h.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,a,o)}),(function(t){r("throw",t,a,o)})):e.resolve(d).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,o)}))}o(h.arg)}var i;s(this,"_invoke",{value:function(t,n){function s(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(s,s):s()}})}function S(e,r,i){var n=f;return function(s,a){if(n===v)throw Error("Generator is already running");if(n===p){if("throw"===s)throw a;return{value:t,done:!0}}for(i.method=s,i.arg=a;;){var o=i.delegate;if(o){var h=M(o,i);if(h){if(h===E)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===f)throw n=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=v;var u=l(e,r,i);if("normal"===u.type){if(n=i.done?p:g,u.arg===E)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=p,i.method="throw",i.arg=u.arg)}}}function M(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,M(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),E;var s=l(n,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,E;var a=s.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,E):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,E)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function U(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(typeof e+" is not iterable")}return x.prototype=_,s(b,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:x,configurable:!0}),x.displayName=d(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,d(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},y(w.prototype),d(w.prototype,h,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,i,n,s){void 0===s&&(s=Promise);var a=new w(c(t,r,i,n),s);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},y(b),d(b,u,"Generator"),d(b,o,(function(){return this})),d(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=N,U.prototype={constructor:U,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(i,n){return o.type="throw",o.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var h=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(h&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(h){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,E):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),L(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;L(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:N(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),E}},e}function i(t,e,r,i,n,s,a){try{var o=t[s](a),h=o.value}catch(t){return void r(t)}o.done?e(h):Promise.resolve(h).then(i,n)}function n(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var a=t.apply(e,r);function o(t){i(a,n,s,o,h,"next",t)}function h(t){i(a,n,s,o,h,"throw",t)}o(void 0)}))}}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function a(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}System.register([],(function(e,i){"use strict";return{execute:function(){function i(t,e){}e({A:function(t){o="webgl"===t},a:i,c:p,d:function(t,e,r){var i=p(Math.max(t.x1,e.x1),Math.max(t.y1,e.y1),Math.min(t.x2,e.x2),Math.min(t.y2,e.y2),r);if(i.x1<i.x2&&i.y1<i.y2)return i;return p(0,0,0,0,i)},e:function(t,e,r){var i=Math.max(t.x,e.x),n=Math.max(t.y,e.y),s=Math.min(t.x+t.width,e.x+e.width)-i,a=Math.min(t.y+t.height,e.y+e.height)-n;if(s>0&&a>0)return r?(r.x=i,r.y=n,r.width=s,r.height=a,r):{x:i,y:n,width:s,height:a};if(r)return r.x=0,r.y=0,r.width=0,r.height=0,r;return{x:0,y:0,width:0,height:0}},f:function(t){return(255&t)/255},g:function(t){var e=Math.floor(255*t[0]),r=Math.floor(255*t[1]),i=Math.floor(255*t[2]),n=Math.floor(255*t[3]);return`rgba(${e},${r},${i},${n.toFixed(4)})`},i:u,j:function(t){return t.x1<t.x2&&t.y1<t.y2},k:function(t,e){return t.x1<e.x2&&t.x2>e.x1&&t.y1<e.y2&&t.y2>e.y1},m:function(t,e,r=!1){var i=(255&t)/255*e,n=o?i:1,s=Math.trunc((t>>>24)*n),a=Math.trunc((t>>>16&255)*n),h=Math.trunc((t>>>8&255)*n),u=Math.trunc(255*i);if(r)return(u<<24|h<<16|a<<8|s)>>>0;return(s<<24|a<<16|h<<8|u)>>>0},n:function(t,e){if(e)return e.x=t.x1,e.y=t.y1,e.width=t.x2-t.x1,e.height=t.y2-t.y1,e;return{x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1}},o:function(t,e){if(e)return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e;return{x:t.x,y:t.y,width:t.width,height:t.height}},q:function(t,e){var r=t>>>24,i=t>>>16&255,n=t>>>8&255,s=Math.trunc((255&t)*e);return(r<<24|i<<16|n<<8|s)>>>0},t:function(t,e,r){var i=Math.trunc(t>>>24),n=Math.trunc(t>>>16&255),s=Math.trunc(t>>>8&255),a=Math.trunc(255&t),o=Math.trunc(e>>>24),h=Math.trunc(e>>>16&255),u=Math.trunc(e>>>8&255),d=Math.trunc(255&e),c=Math.round(o*r+i*(1-r)),l=Math.round(h*r+n*(1-r)),f=Math.round(u*r+s*(1-r)),g=Math.round(d*r+a*(1-r));return(c<<24|l<<16|f<<8|g)>>>0},u:function(t,e){return t.x1<=e.x2&&t.y1<=e.y2&&t.x2>=e.x1&&t.y2>=e.y1}});var o=!0;function h(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function u(){return{BASE_URL:"/solid-demo-app/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!0}&&!0}class d{constructor(){a(this,"eventListeners",{})}on(t,e){var r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){var r=this.eventListeners[t];if(r)if(e){var i=r.indexOf(e);i>=0&&r.splice(i,1)}else delete this.eventListeners[t]}once(t,e){var r=(i,n)=>{this.off(t,r),e(i,n)};this.on(t,r)}emit(t,e){var r=this.eventListeners[t];r&&[...r].forEach((t=>{t(this,e)}))}removeAllListeners(){this.eventListeners={}}}e("E",d);class c{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function l(t,e,r){var i=t.createShader(e);if(!i)throw new Error;if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}e("C",c);class f extends c{constructor(t){super(),a(this,"boundBufferCollection",null),a(this,"buffersBound",!1),a(this,"program",void 0),a(this,"vao",void 0),a(this,"renderer",void 0),a(this,"glw",void 0),a(this,"attributeBuffers",void 0),a(this,"attributeLocations",void 0),a(this,"attributeNames",void 0),a(this,"uniformLocations",void 0),a(this,"uniformTypes",void 0),a(this,"supportsIndexedTextures",void 0);var e=this.renderer=t.renderer,r=this.glw=this.renderer.glw;this.supportsIndexedTextures=t.supportsIndexedTextures||!1;var i=r.isWebGl2(),n=i&&t.webgl2Extensions||!i&&t.webgl1Extensions||[],s=i?"2.0":"1.0";n.forEach((t=>{if(!r.getExtension(t))throw new Error(`Shader "${this.constructor.name}" requires extension "${t}" for WebGL ${s} but wasn't found`)}));var o=t.shaderSources||this.constructor.shaderSources;if(!o)throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);i&&null!=o&&o.webGl2&&(o.fragment=o.webGl2.fragment,o.vertex=o.webGl2.vertex,delete o.webGl2);var h=e.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,u=o.vertex instanceof Function?o.vertex(h):o.vertex,d=o.fragment instanceof Function?o.fragment(h):o.fragment,c=l(r,r.VERTEX_SHADER,u),f=l(r,r.FRAGMENT_SHADER,d);if(!c||!f)throw new Error;var g=function(t,e,r){var i=t.createProgram();if(!i)throw new Error;if(t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS))return i;console.log(t.getProgramInfoLog(i)),t.deleteProgram(i)}(r,c,f);if(!g)throw new Error;if(this.program=g,i){var v=r.createVertexArray();if(!v)throw new Error;this.vao=v,r.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...t.attributes].forEach((t=>{var e=r.getAttribLocation(this.program,t);if(e<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${t}"!`);var i=r.createBuffer();if(!i)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${t}"`);this.attributeLocations[t]=e,this.attributeBuffers[t]=i,this.attributeNames.push(t)})),this.uniformLocations={},this.uniformTypes={},t.uniforms.forEach((t=>{var e=r.getUniformLocation(this.program,t.name);this.uniformTypes[t.name]=t.uniform,e?this.uniformLocations[t.name]=e:console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${t.name}"`)}))}bindBufferAttribute(t,e,r){var i=this.glw;i.enableVertexAttribArray(t),i.vertexAttribPointer(e,t,r.size,r.type,r.normalized,r.stride,r.offset)}disableAttribute(t){this.glw.disableVertexAttribArray(t)}disableAttributes(){for(var t in this.attributeLocations)this.disableAttribute(this.attributeLocations[t]);this.boundBufferCollection=null}canBatchShaderProps(t,e){return!1}bindRenderOp(t,e){this.bindBufferCollection(t.buffers),t.textures.length>0&&this.bindTextures(t.textures);var r=t.glw,i=t.parentHasRenderTexture;if(!t.renderToTexture||!i){if(i){var n=t.framebufferDimensions||{},s=n.width,a=n.height;this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([null!=s?s:0,null!=a?a:0]))}else this.setUniform("u_pixelRatio",t.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([r.canvas.width,r.canvas.height]));if(e){if(h(e,"$dimensions")){var o=e.$dimensions;o||(o=t.dimensions),this.setUniform("u_dimensions",[o.width,o.height])}if(h(e,"$alpha")){var u=e.$alpha;u||(u=t.alpha),this.setUniform("u_alpha",u)}this.bindProps(e)}}}setUniform(t,...e){this.glw.setUniform(this.uniformTypes[t],this.uniformLocations[t],...e)}bindBufferCollection(t){if(this.boundBufferCollection!==t){for(var e in this.attributeLocations){var r=t.getBuffer(e),i=t.getAttributeInfo(e);this.bindBufferAttribute(this.attributeLocations[e],r,i)}this.boundBufferCollection=t}}bindProps(t){}bindTextures(t){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}a(f,"shaderSources",void 0),e("W",f);class g extends d{constructor(t){super(),a(this,"txManager",void 0),a(this,"dimensions",null),a(this,"error",null),a(this,"state","freed"),a(this,"renderableOwners",new Set),this.txManager=t}setRenderableOwner(t,e){e?this.renderableOwners.add(t):this.renderableOwners.delete(t)}get renderable(){return this.renderableOwners.size>0}setState(t,...e){if(this.state!==t){if(this.state=t,"loaded"===t){var r=e;this.dimensions=r[0]}else if("failed"===t){var i=e;this.error=i[0]}this.emit(t,...e)}}static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}e("h",g);var v=e("b",(t=>[(t>>>24)/255,(t>>>16&255)/255,(t>>>8&255)/255,(255&t)/255]));e("z",(t=>[t>>>24,t>>>16&255,t>>>8&255,255&t]));function p(t,e,r,i,n){return n?(n.x1=t,n.y1=e,n.x2=r,n.y2=i,n):{x1:t,y1:e,x2:r,y2:i}}class E extends d{constructor(t){super(),a(this,"fontFamily",void 0),a(this,"descriptors",void 0),a(this,"loaded",!1),a(this,"metrics",null);var e=t.fontFamily,r=t.descriptors,i=t.metrics;i&&(this.metrics={ascender:i.ascender/i.unitsPerEm,descender:i.descender/i.unitsPerEm,lineGap:i.lineGap/i.unitsPerEm}),this.fontFamily=e,this.descriptors=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({style:"normal",weight:"normal",stretch:"normal"},r)}static convertToCssFontFaceDescriptors(t){return{style:t.style,weight:"number"==typeof t.weight?`${t.weight}`:t.weight,stretch:t.stretch,unicodeRange:t.unicodeRange,variant:t.variant,featureSettings:t.featureSettings,display:t.display}}}e("T",E);class T extends g{constructor(t,e){super(t),a(this,"props",void 0),this.props=T.resolveDefaults(e||{})}get color(){return this.props.color}set color(t){this.props.color=t}getTextureData(){var t=this;return n(r().mark((function e(){var i,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Uint32Array([t.color]),n=new Uint8ClampedArray(i.buffer),e.abrupt("return",{data:new ImageData(n,1,1),premultiplyAlpha:!0});case 3:case"end":return e.stop()}}),e)})))()}static makeCacheKey(t){return`ColorTexture,${T.resolveDefaults(t).color}`}static resolveDefaults(t){return{color:t.color||4294967295}}}a(T,"z$__type__Props",void 0),e("v",T);class x{constructor(t,e){a(this,"memManager",void 0),a(this,"textureSource",void 0),this.memManager=t,this.textureSource=e}}e("x",x);class _{constructor(t){a(this,"options",void 0),a(this,"mode",void 0),a(this,"stage",void 0),a(this,"txManager",void 0),a(this,"txMemManager",void 0),a(this,"shManager",void 0),a(this,"rttNodes",[]),this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}e("y",_);class m{}class R extends m{constructor(t,e,r,i,n,s,o,h,u,d,c,l,f){super(),a(this,"glw",void 0),a(this,"options",void 0),a(this,"buffers",void 0),a(this,"shader",void 0),a(this,"shaderProps",void 0),a(this,"alpha",void 0),a(this,"clippingRect",void 0),a(this,"dimensions",void 0),a(this,"bufferIdx",void 0),a(this,"zIndex",void 0),a(this,"renderToTexture",void 0),a(this,"parentHasRenderTexture",void 0),a(this,"framebufferDimensions",void 0),a(this,"length",0),a(this,"numQuads",0),a(this,"textures",[]),a(this,"maxTextures",void 0),this.glw=t,this.options=e,this.buffers=r,this.shader=i,this.shaderProps=n,this.alpha=s,this.clippingRect=o,this.dimensions=h,this.bufferIdx=u,this.zIndex=d,this.renderToTexture=c,this.parentHasRenderTexture=l,this.framebufferDimensions=f,this.maxTextures=i.supportsIndexedTextures?t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(t){var e=this.textures,r=this.maxTextures,i=e.findIndex((e=>e===t));if(-1!==i)return i;var n=e.length;return n>=r?4294967295:(this.textures.push(t),n)}draw(){var t=this.glw,e=this.shader,r=this.shaderProps,i=this.options;i.shManager.useShader(e),e.bindRenderOp(this,r);var n=this.bufferIdx/24*6*2;if(this.clippingRect.valid){var s=this.clippingRect,a=s.x,o=s.y,h=s.width,u=s.height,d=i.pixelRatio,c=i.canvas.height,l=Math.round(a*d),f=Math.round(h*d),g=Math.round(u*d),v=Math.round(c-g-o*d);t.setScissorTest(!0),t.scissor(l,v,f,g)}else t.setScissorTest(!1);t.drawElements(t.TRIANGLES,6*this.numQuads,t.UNSIGNED_SHORT,n)}}function A(t){var e={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(e).forEach((r=>{e[r]=t.getParameter(t[r])})),e}function b(t){var e={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(e).forEach((r=>{e[r]=t.getExtension(r)})),e}e("p",R);var y=t=>t&&!(t&t-1),w=(t,e,r,i)=>{var n=3*t,s=3*(r-t)-n,a=1-n-s,o=3*e,h=3*(i-e)-o,u=1-o-h;return function(t){if(t>=1)return 1;if(t<=0)return 0;for(var e,r,i=.5,d=0;d<20;d++){if((r=t-i*(i*(i*a+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);if((e=i*(i*(3*a)+2*s)+n)>1e-10&&e<1e-10)break;i+=r/e}for(var c=0,l=1,f=0;f<20;f++){if((r=t-(i=.5*(c+l))*(i*(i*a+s)+n))>-1e-8&&r<1e-8)return i*(i*(i*u+h)+o);r<0?l=i:c=i}}},S={},M={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},I=t=>t;e("s",(e=>{if(""===e)return I;if(void 0!==S[e])return S[e]||I;if("linear"===e)return t=>t;if("step-start"===e)return()=>1;if("step-end"===e)return t=>1===t?1:0;if(void 0!==M[e]){var r=t(M[e],4),i=r[0],n=r[1],s=r[2],a=r[3],o=w(i,n,s,a);return S[e]=o,o}return e.startsWith("cubic-bezier")?(e=>{var r=e.match(/-?\d*\.?\d+/g);if(r){var i=t(r,4),n=i[0],s=i[1],a=i[2],o=i[3],h=parseFloat(n||"0.42"),u=parseFloat(s||"0"),d=parseFloat(a||"1"),c=parseFloat(o||"1"),l=w(h,u,d,c);return S[e]=l,l}return console.warn("Unknown cubic-bezier timing: "+e),I})(e):(console.warn("Unknown timing function: "+e),I)}));Math.hypot||(Math.hypot=(...t)=>{for(var e=0,r=t.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var L=new Uint8Array([0,0,0,0]);class U extends x{constructor(t,e,r){super(e,r),a(this,"glw",void 0),a(this,"_nativeCtxTexture",null),a(this,"_state","freed"),a(this,"_w",0),a(this,"_h",0),this.glw=t}get ctxTexture(){return"freed"===this._state&&this.load(),this._nativeCtxTexture,this._nativeCtxTexture}get renderable(){return this.textureSource.renderable}get w(){return this._w}get h(){return this._h}load(){"loading"!==this._state&&"loaded"!==this._state&&(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then((({width:t,height:e})=>{"freed"!==this._state&&(this._state="loaded",this._w=t,this._h=e,this.textureSource.setState("loaded",{width:t,height:e}))})).catch((t=>{"freed"!==this._state&&(this._state="failed",this.textureSource.setState("failed",t),console.error(t))})))}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,s,a,o,h,u,d,c,l,f,g,v,p,E,T,x;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.glw,s=t.memManager,n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,null),s.setTextureMemUse(t,L.byteLength),e.next=5,null===(i=t.textureSource)||void 0===i?void 0:i.getTextureData();case 5:if(a=e.sent,t._nativeCtxTexture){e.next=9;break}return t._state,e.abrupt("return",{width:0,height:0});case 9:return o=0,h=0,t._nativeCtxTexture,n.activeTexture(0),a.data instanceof ImageBitmap||a.data instanceof ImageData||null!==(r=a.data)&&"object"==typeof r&&r.constructor&&"HTMLImageElement"===r.constructor.name?(u=a.data,o=u.width,h=u.height,n.bindTexture(t._nativeCtxTexture),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!a.premultiplyAlpha),n.texImage2D(0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,u),s.setTextureMemUse(t,o*h*4),(n.isWebGl2()||y(o)&&y(h))&&n.generateMipmap()):null===a.data?(o=0,h=0,n.bindTexture(t._nativeCtxTexture),n.texImage2D(0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,L),s.setTextureMemUse(t,L.byteLength)):"mipmaps"in a.data&&a.data.mipmaps?(c=a.data,l=c.mipmaps,f=c.width,g=void 0===f?0:f,v=c.height,p=void 0===v?0:v,E=c.type,T=c.glInternalFormat,x="ktx"===E?new DataView(null!==(d=l[0])&&void 0!==d?d:new ArrayBuffer(0)):l[0],n.bindTexture(t._nativeCtxTexture),n.compressedTexImage2D(0,T,g,p,0,x),n.texParameteri(n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_MIN_FILTER,n.LINEAR),s.setTextureMemUse(t,x.byteLength)):console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",a),e.abrupt("return",{width:o,height:h});case 15:case"end":return e.stop()}var r}),e)})))()}free(){if("freed"!==this._state&&(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,this._nativeCtxTexture)){var t=this.glw,e=this.memManager;t.deleteTexture(this._nativeCtxTexture),e.setTextureMemUse(this,0),this._nativeCtxTexture=null}}createNativeCtxTexture(){var t=this.glw,e=t.createTexture();if(!e)throw new Error("Could not create WebGL Texture");return t.activeTexture(0),t.bindTexture(e),t.texParameteri(t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}}class N extends g{constructor(t,e){super(t),a(this,"props",void 0),a(this,"parentTexture",void 0),a(this,"onParentTxLoaded",(()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})})),a(this,"onParentTxFailed",((t,e)=>{this.setState("failed",e)})),this.parentTexture=this.txManager.loadTexture(e.texture.txType,e.texture.props,e.texture.options),this.props=N.resolveDefaults(e||{}),queueMicrotask((()=>{var t=this.parentTexture;"loaded"===t.state?this.onParentTxLoaded(t,t.dimensions):"failed"===t.state&&this.onParentTxFailed(t,t.error),t.on("loaded",this.onParentTxLoaded),t.on("failed",this.onParentTxFailed)}))}getTextureData(){var t=this;return n(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:t.props});case 1:case"end":return e.stop()}}),e)})))()}static makeCacheKey(t){return!1}static resolveDefaults(t){return{texture:t.texture,x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}}a(N,"z$__type__Props",void 0),e("w",N);class P extends U{constructor(t,e,r){super(t,e,r)}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.textureSource.getTextureData();case 2:return s=e.sent,e.abrupt("return",{width:(null===(i=s.data)||void 0===i?void 0:i.width)||0,height:(null===(n=s.data)||void 0===n?void 0:n.height)||0});case 4:case"end":return e.stop()}}),e)})))()}}class O{constructor(t){a(this,"config",void 0),this.config=t}getBuffer(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.buffer}getAttributeInfo(t){var e;return null===(e=this.config.find((e=>e.attributes[t])))||void 0===e?void 0:e.attributes[t]}}e("B",O);class B{constructor(t){a(this,"gl",void 0),a(this,"activeTextureUnit",0),a(this,"texture2dUnits",void 0),a(this,"texture2dParams",new WeakMap),a(this,"scissorEnabled",void 0),a(this,"scissorX",void 0),a(this,"scissorY",void 0),a(this,"scissorWidth",void 0),a(this,"scissorHeight",void 0),a(this,"blendEnabled",void 0),a(this,"blendSrcRgb",void 0),a(this,"blendDstRgb",void 0),a(this,"blendSrcAlpha",void 0),a(this,"blendDstAlpha",void 0),a(this,"boundArrayBuffer",void 0),a(this,"boundElementArrayBuffer",void 0),a(this,"curProgram",void 0),a(this,"programUniforms",new WeakMap),a(this,"canvas",void 0),a(this,"MAX_RENDERBUFFER_SIZE",void 0),a(this,"MAX_TEXTURE_SIZE",void 0),a(this,"MAX_VIEWPORT_DIMS",void 0),a(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS",void 0),a(this,"MAX_TEXTURE_IMAGE_UNITS",void 0),a(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS",void 0),a(this,"MAX_VERTEX_ATTRIBS",void 0),a(this,"MAX_VARYING_VECTORS",void 0),a(this,"MAX_VERTEX_UNIFORM_VECTORS",void 0),a(this,"MAX_FRAGMENT_UNIFORM_VECTORS",void 0),a(this,"TEXTURE_MAG_FILTER",void 0),a(this,"TEXTURE_MIN_FILTER",void 0),a(this,"TEXTURE_WRAP_S",void 0),a(this,"TEXTURE_WRAP_T",void 0),a(this,"LINEAR",void 0),a(this,"CLAMP_TO_EDGE",void 0),a(this,"RGBA",void 0),a(this,"UNSIGNED_BYTE",void 0),a(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL",void 0),a(this,"UNPACK_FLIP_Y_WEBGL",void 0),a(this,"FLOAT",void 0),a(this,"TRIANGLES",void 0),a(this,"UNSIGNED_SHORT",void 0),a(this,"ONE",void 0),a(this,"ONE_MINUS_SRC_ALPHA",void 0),a(this,"VERTEX_SHADER",void 0),a(this,"FRAGMENT_SHADER",void 0),a(this,"STATIC_DRAW",void 0),a(this,"COMPILE_STATUS",void 0),a(this,"LINK_STATUS",void 0),a(this,"DYNAMIC_DRAW",void 0),a(this,"COLOR_ATTACHMENT0",void 0),this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map(((e,r)=>(this.activeTexture(r),t.getParameter(t.TEXTURE_BINDING_2D)))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);var r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return t=this.gl,self.WebGL2RenderingContext&&t instanceof self.WebGL2RenderingContext;var t}activeTexture(t){var e=this.gl;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){var e=this.gl,r=this.activeTextureUnit,i=this.texture2dUnits;i[r]!==t&&(i[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){var t=this.activeTextureUnit;return this.texture2dUnits[t]}texParameteri(t,e){var r=this.gl,i=this.texture2dParams,n=this._getActiveTexture();if(!n)throw new Error("No active texture");var s=i.get(n);s||(s={},i.set(n,s)),s[t]!==e&&(s[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,i,n,s,a,o){var h=this.gl;s?h.texImage2D(h.TEXTURE_2D,t,e,r,i,n,s,a,o):h.texImage2D(h.TEXTURE_2D,t,e,r,i,n)}compressedTexImage2D(t,e,r,i,n,s){var a=this.gl;a.compressedTexImage2D(a.TEXTURE_2D,t,e,r,i,n,s)}pixelStorei(t,e){this.gl.pixelStorei(t,e)}generateMipmap(){var t=this.gl;t.generateMipmap(t.TEXTURE_2D)}createTexture(){return this.gl.createTexture()}deleteTexture(t){var e=this.gl;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,i){this.gl.viewport(t,e,r,i)}clearColor(t,e,r,i){this.gl.clearColor(t,e,r,i)}setScissorTest(t){var e=this.gl;t!==this.scissorEnabled&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,i){var n=this.gl,s=this.scissorX,a=this.scissorY,o=this.scissorWidth,h=this.scissorHeight;t===s&&e===a&&r===o&&i===h||(n.scissor(t,e,r,i),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=i)}setBlend(t){var e=this.gl;t!==this.blendEnabled&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){var r=this.gl,i=this.blendSrcRgb,n=this.blendDstRgb,s=this.blendSrcAlpha,a=this.blendDstAlpha;t===i&&e===n&&t===s&&e===a||(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){return this.gl.createBuffer()}createFramebuffer(){return this.gl.createFramebuffer()}bindFramebuffer(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){var i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e,r)}clear(){var t=this.gl;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){var i=this.gl;this.boundArrayBuffer!==t&&(i.bindBuffer(i.ARRAY_BUFFER,t),this.boundArrayBuffer=t),i.bufferData(i.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){var i=this.gl;this.boundElementArrayBuffer!==t&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,i,n,s,a){var o=this.gl;this.boundArrayBuffer!==t&&(o.bindBuffer(o.ARRAY_BUFFER,t),this.boundArrayBuffer=t),o.vertexAttribPointer(e,r,i,n,s,a)}useProgram(t){var e=this.gl;this.curProgram!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...r){var i=this.gl,n=this.programUniforms,s=n.get(this.curProgram);s||(s=new Map,n.set(this.curProgram,s));var a=s.get(e);a&&function(t,e){if(t.length!==e.length)return!1;return t.every(((t,r)=>!(Array.isArray(t)||t instanceof Float32Array)&&t===e[r]))}(a,r)||(s.set(e,r),i[t](e,...r))}getParameter(t){return this.gl.getParameter(t)}drawElements(t,e,r,i){this.gl.drawElements(t,e,r,i)}getExtension(t){return this.gl.getExtension(t)}createVertexArray(){var t=this.gl;return WebGL2RenderingContext,t.createVertexArray()}bindVertexArray(t){var e=this.gl;WebGL2RenderingContext,e.bindVertexArray(t)}getAttribLocation(t,e){return this.gl.getAttribLocation(t,e)}getUniformLocation(t,e){return this.gl.getUniformLocation(t,e)}enableVertexAttribArray(t){this.gl.enableVertexAttribArray(t)}disableVertexAttribArray(t){this.gl.disableVertexAttribArray(t)}createShader(t){return this.gl.createShader(t)}compileShader(t){this.gl.compileShader(t)}attachShader(t,e){this.gl.attachShader(t,e)}linkProgram(t){this.gl.linkProgram(t)}deleteProgram(t){this.gl.deleteProgram(t)}getShaderParameter(t,e){return this.gl.getShaderParameter(t,e)}getShaderInfoLog(t){return this.gl.getShaderInfoLog(t)}createProgram(){return this.gl.createProgram()}getProgramParameter(t,e){return this.gl.getProgramParameter(t,e)}getProgramInfoLog(t){return this.gl.getProgramInfoLog(t)}shaderSource(t,e){this.gl.shaderSource(t,e)}deleteShader(t){this.gl.deleteShader(t)}}class D extends g{constructor(t,e){super(t),a(this,"props",void 0),this.props=D.resolveDefaults(e||{})}get width(){return this.props.width}set width(t){this.props.width=t}get height(){return this.props.height}set height(t){this.props.height=t}getTextureData(){return n(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{data:null,premultiplyAlpha:null});case 1:case"end":return t.stop()}}),t)})))()}static resolveDefaults(t){return{width:t.width||256,height:t.height||256}}}a(D,"z$__type__Props",void 0),e("R",D);class G extends U{constructor(t,e,r){super(t,e,r),a(this,"framebuffer",void 0);var i=t.createFramebuffer();this.framebuffer=i}onLoadRequest(){var t=this;return n(r().mark((function e(){var i,n,s,a,o,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.glw,n=t.memManager,s=t._nativeCtxTexture=t.createNativeCtxTexture(),a=t.textureSource,o=a.width,h=a.height,i.texImage2D(0,i.RGBA,o,h,0,i.RGBA,i.UNSIGNED_BYTE,null),n.setTextureMemUse(t,o*h*4),i.bindFramebuffer(t.framebuffer),i.framebufferTexture2D(i.COLOR_ATTACHMENT0,s,0),i.bindFramebuffer(null),e.abrupt("return",{width:o,height:h});case 9:case"end":return e.stop()}}),e)})))()}}class X extends _{constructor(t){super(t),a(this,"glw",void 0),a(this,"system",void 0),a(this,"quadBuffer",new ArrayBuffer(4194304)),a(this,"fQuadBuffer",new Float32Array(this.quadBuffer)),a(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer)),a(this,"renderOps",[]),a(this,"curBufferIdx",0),a(this,"curRenderOp",null),a(this,"rttNodes",[]),a(this,"activeRttNode",null),a(this,"defaultShader",void 0),a(this,"quadBufferCollection",void 0),a(this,"defaultTexture",void 0),a(this,"renderToTextureActive",!1),this.mode="webgl";var e=t.canvas,r=t.clearColor,i=t.bufferMemory;this.defaultTexture=new T(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",(()=>{this.stage.requestRender()}));var n=function(t,e){var r={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r);if(!i)throw new Error("Unable to create WebGL context");return e?new Proxy(i,{get(t,r){var i=t[r];return"function"==typeof i?(e.increment(String(r)),i.bind(t)):i}}):i}(e,t.contextSpy),s=this.glw=new B(n),o=v(r);s.viewport(0,0,e.width,e.height),s.clearColor(o[0],o[1],o[2],o[3]),s.setBlend(!0),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),function(t,e){for(var r=~~(e/80),i=new Uint16Array(6*r),n=0,s=0;n<r;n+=6,s+=4)i[n]=s,i[n+1]=s+1,i[n+2]=s+2,i[n+3]=s+2,i[n+4]=s+1,i[n+5]=s+3;var a=t.createBuffer();t.elementArrayBufferData(a,i,t.STATIC_DRAW)}(s,i),this.system={parameters:A(this.glw),extensions:b(this.glw)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;var h=s.createBuffer(),u=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new O([{buffer:h,attributes:{a_position:{name:"a_position",size:2,type:s.FLOAT,normalized:!1,stride:u,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:s.FLOAT,normalized:!1,stride:u,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:s.UNSIGNED_BYTE,normalized:!0,stride:u,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:s.FLOAT,normalized:!1,stride:u,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){var t=this.glw;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,t.setScissorTest(!1),t.clear()}getShaderManager(){return this.shManager}createCtxTexture(t){return t instanceof N?new P(this.glw,this.txMemManager,t):t instanceof D?new G(this.glw,this.txMemManager,t):new U(this.glw,this.txMemManager,t)}addQuad(t){var e,r,i,n=this.fQuadBuffer,s=this.uiQuadBuffer,a=t.width,o=t.height,u=t.colorTl,d=t.colorTr,c=t.colorBl,l=t.colorBr,f=t.textureOptions,g=t.shader,v=t.shaderProps,p=t.alpha,E=t.clippingRect,T=t.tx,x=t.ty,_=t.ta,m=t.tb,R=t.tc,A=t.td,b=t.rtt,y=t.parentHasRenderTexture,w=t.framebufferDimensions,S=t.texture;if(v&&h(v,"$dimensions")){var M=v.$dimensions;M.width=a,M.height=o}S=null!==(e=S)&&void 0!==e?e:this.defaultTexture;var I=this.curBufferIdx,L=this.curRenderOp,U={width:a,height:o},P=g||this.defaultShader;this.reuseRenderOp(t)||(this.newRenderOp(P,v,p,U,E,I,b,y,w),L=this.curRenderOp);var O=null!==(r=null==f?void 0:f.flipX)&&void 0!==r&&r,B=null!==(i=null==f?void 0:f.flipY)&&void 0!==i&&i,D=0,G=0,X=1,C=1;if(S instanceof N){var F=S.props,V=F.x,W=F.y,k=F.width,Y=F.height,H=S.parentTexture.dimensions||{width:0,height:0},j=H.width,$=void 0===j?0:j,z=H.height,q=void 0===z?0:z;X=(D=V/$)+k/$,C=(G=W/q)+Y/q,S=S.parentTexture}if(O){var K=[X,D];D=K[0],X=K[1]}if(B){var Q=[C,G];G=Q[0],C=Q[1]}var Z=this.stage.txManager.getCtxTexture(S),J=this.addTexture(Z,I);if(L=this.curRenderOp,0!==m||0!==R)n[I++]=T,n[I++]=x,n[I++]=D,n[I++]=G,s[I++]=u,n[I++]=J,n[I++]=T+a*_,n[I++]=x+a*R,n[I++]=X,n[I++]=G,s[I++]=d,n[I++]=J,n[I++]=T+o*m,n[I++]=x+o*A,n[I++]=D,n[I++]=C,s[I++]=c,n[I++]=J,n[I++]=T+a*_+o*m,n[I++]=x+a*R+o*A,n[I++]=X,n[I++]=C,s[I++]=l,n[I++]=J;else{var tt=T+a*_,et=x+o*A;n[I++]=T,n[I++]=x,n[I++]=D,n[I++]=G,s[I++]=u,n[I++]=J,n[I++]=tt,n[I++]=x,n[I++]=X,n[I++]=G,s[I++]=d,n[I++]=J,n[I++]=T,n[I++]=et,n[I++]=D,n[I++]=C,s[I++]=c,n[I++]=J,n[I++]=tt,n[I++]=et,n[I++]=X,n[I++]=C,s[I++]=l,n[I++]=J}L.length+=24,L.numQuads++,this.curBufferIdx=I}newRenderOp(t,e,r,i,n,s,a,o,h){var u=new R(this.glw,this.options,this.quadBufferCollection,t,e,r,n,i,s,0,a,o,h);this.curRenderOp=u,this.renderOps.push(u)}addTexture(t,e,r){var i=this.curRenderOp,n=i.addTexture(t);if(4294967295===n){if(r)throw new Error("Unable to add texture to render op");var s=i.shader,a=i.shaderProps,o=i.dimensions,h=i.clippingRect,u=i.alpha;return this.newRenderOp(s,a,u,o,h,e),this.addTexture(t,e,!0)}return n}reuseRenderOp(t){var e,r,i,n=t.shader,s=t.shaderProps,a=t.parentHasRenderTexture,o=t.rtt,h=t.clippingRect,u=n||this.defaultShader;return(null===(e=this.curRenderOp)||void 0===e?void 0:e.shader)===u&&(((r=this.curRenderOp.clippingRect)===(i=h)||null!==r&&null!==i&&r.x===i.x&&r.y===i.y&&r.width===i.width&&r.height===i.height)&&(!a&&!o&&!!(this.curRenderOp.shader===this.defaultShader||s&&this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,s))))}addRenderOp(t){this.renderOps.push(t),this.curRenderOp=null}render(t="screen"){var e,r=this.glw,i=this.quadBuffer,n=new Float32Array(i,0,this.curBufferIdx),s=null!==(e=this.quadBufferCollection.getBuffer("a_position"))&&void 0!==e?e:null;r.arrayBufferData(s,n,r.STATIC_DRAW),this.renderOps.forEach(((t,e)=>{t.draw()}))}renderToTexture(t){for(var e=0;e<this.rttNodes.length;e++)if(this.rttNodes[e]===t)return;this.rttNodes.unshift(t)}renderRTTNodes(){for(var t=this.glw,e=this.stage.txManager,r=0;r<this.rttNodes.length;r++){var i=this.rttNodes[r];if(i&&i.hasRTTupdates){this.activeRttNode=i,i.texture;var n=e.getCtxTexture(i.texture);this.renderToTextureActive=!0,t.bindFramebuffer(n.framebuffer),t.viewport(0,0,n.w,n.h),t.clear();for(var s=0;s<i.children.length;s++){var a=i.children[s];a&&(a.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(a),a.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}}t.bindFramebuffer(null),t.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(t){var e=this.rttNodes.indexOf(t);-1!==e&&this.rttNodes.splice(e,1)}}e("l",X);var C=10;class F{}class V extends F{constructor(t,e){super(),a(this,"data",void 0),a(this,"glyphMap",void 0),a(this,"kernings",void 0),this.data=t,this.glyphMap=e;var r=this.kernings={};t.kernings.forEach((t=>{var e=t.second;(r[e]=r[e]||{})[t.first]=t.amount})),this.kernings=r}shapeText(t,e){var i=this;return r().mark((function n(){var s,a,o,h,u,d;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=void 0;case 1:if(!(s=e.peek())||s.done){r.next=17;break}if(o=s.value,h=i.glyphMap.get(o),e.next(),void 0===h){r.next=12;break}return d=void 0!==a?((null===(u=i.kernings[h.id])||void 0===u?void 0:u[a])||0)+t.letterSpacing:0,a=h.id,r.next=10,{mapped:!0,glyphId:h.id,codepoint:o,cluster:e.lastIndex,xAdvance:h.xadvance+d,yAdvance:0,xOffset:h.xoffset+d,yOffset:h.yoffset,xBearing:0,yBearing:0,width:h.width,height:h.height};case 10:r.next=15;break;case 12:return o===C&&(a=void 0),r.next=15,{mapped:!1,codepoint:o,cluster:e.lastIndex};case 15:r.next=1;break;case 17:case"end":return r.stop()}}),n)}))()}}e("S",class extends E{constructor(t,e){var i;super(e),i=this,a(this,"type",void 0),a(this,"texture",void 0),a(this,"maxCharHeight",0),a(this,"data",void 0),a(this,"shaper",void 0),a(this,"glyphMap",new Map);var s=e.atlasUrl,o=e.atlasDataUrl,h=e.stage;this.type=t;h.renderer;this.texture=h.txManager.loadTexture("ImageTexture",{src:s,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",(()=>{this.checkLoaded()})),fetch(o).then(function(){var t=n(r().mark((function t(e){var n,s,a,o,h,u,d;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.json();case 2:if(i.data=t.sent,i.data,n=0,i.data.chars.forEach((t=>{i.glyphMap.set(t.id,t);var e=t.yoffset+t.height;e>n&&(n=e)})),i.maxCharHeight=n,i.shaper=new V(i.data,i.glyphMap),i.metrics){t.next=15;break}if(null===(s=i.data)||void 0===s||!s.lightningMetrics){t.next=14;break}a=i.data.lightningMetrics,o=a.ascender,h=a.descender,u=a.lineGap,d=a.unitsPerEm,i.metrics={ascender:o/d,descender:h/d,lineGap:u/d},t.next=15;break;case 14:throw new Error(`Font metrics not found in ${i.type} font ${i.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);case 15:i.checkLoaded();case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch(console.error)}getAtlasEntry(t){var e=this.glyphMap.get(t);if(void 0===e)throw new Error(`Glyph ${t} not found in font ${this.fontFamily}`);return{x:e.x,y:e.y,width:e.width,height:e.height}}checkLoaded(){this.loaded||"loaded"===this.texture.state&&this.data&&(this.loaded=!0,this.emit("loaded"))}});e("r",class{})}}}))}();
//# sourceMappingURL=CoreExtension-legacy-mpYsTIFj.js.map

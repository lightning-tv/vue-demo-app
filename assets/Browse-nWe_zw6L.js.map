{"version":3,"file":"Browse-nWe_zw6L.js","sources":["../../src/api/key.ts","../../src/api/index.ts","../../src/api/formatters/ItemFormatter.ts","../../src/api/providers/browse.ts","../../src/components/ContentBlock.vue","../../src/components/Row.vue","../../src/pages/Browse.vue"],"sourcesContent":["export default 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZDE4YjEwMTA0YjdiZTlkNjFiMWYwYjVlMGEwNzM2OCIsInN1YiI6IjYwZTVjMTdlNGNhNjc2MDA3NTA4Njc3MSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.D_nqH9kd-bhhWzeVsTDPYhHnsUaNAuyAa6YATmKHqsA';\n","import API_KEY_V4 from './key';\nconst API_BASE = 'https://api.themoviedb.org/3';\nlet tmdbConfig;\nlet baseImageUrl;\nconst basePosterSize = 'w185';\n\nconst defaultFetchParams = {\n  headers: {\n    'Content-Type': 'application/json',\n    Authorization: 'Bearer ' + API_KEY_V4,\n  },\n};\n\nexport function getImageUrl(path: string, posterSize: string = basePosterSize) {\n  return baseImageUrl + posterSize + path;\n}\n\nfunction get(path: string, params: RequestInit = {}) {\n  if (tmdbConfig) {\n    return _get(path, params);\n  } else {\n    return loadConfig().then(() => _get(path, params));\n  }\n}\n\nfunction _get(path: string, params: RequestInit = {}) {\n  return fetch(API_BASE + path, {\n    ...defaultFetchParams,\n    ...params,\n  }).then((r) => r.json());\n}\n\nfunction loadConfig() {\n  return _get('/configuration').then((data) => {\n    tmdbConfig = data;\n    baseImageUrl = data.images?.secure_base_url;\n    return data;\n  });\n}\n\nexport default {\n  get,\n  loadConfig,\n};\n","import { getImageUrl } from '../index';\n\nfunction truncateString(str: string, maxLength: number): string {\n  if (str.length > maxLength) {\n    return str.substring(0, maxLength - 3) + '...';\n  }\n  return str;\n}\n\nexport function chunkArray(array: string[], size = 7) {\n  const result: string[][] = [];\n  for (let i = 0, j = array.length; i < j; i += size) {\n    result.push(array.slice(i, i + size));\n  }\n  return result;\n}\n\nexport interface Tile {\n  src: string;\n  tileSrc: string;\n  backdrop: string;\n  href: string;\n  shortTitle: string;\n  title: string;\n  data: unknown;\n  entityInfo: {\n    type: string;\n    id: string;\n  };\n  heroContent: {\n    title: string;\n    description: string;\n  };\n}\n\n// TODO: Remove `any` type\nexport function convertItemsToTiles(items: any[] = []): Tile[] {\n  return items.map((item) => ({\n    src: getImageUrl(item.poster_path || item.profile_path),\n    tileSrc: getImageUrl(item.backdrop_path || item.profile_path, 'w300'),\n    backdrop: getImageUrl(item.backdrop_path, 'w1280'),\n    href: `/entity/${item.media_type || 'people'}/${item.id}`,\n    shortTitle: truncateString(item.title || item.name, 30),\n    title: item.title || item.name,\n    data: item,\n    entityInfo: {\n      type: item.media_type || 'people',\n      id: item.id,\n    },\n    heroContent: {\n      title: item.title || item.name,\n      description: item.overview,\n    },\n  }));\n}\n","import api from '..';\nimport { convertItemsToTiles, chunkArray } from '../formatters/ItemFormatter';\n\nconst cache = new Map();\nconst leftoverTiles = new Map();\n\nexport default function (filter: string) {\n  return (pageIndex: number): Promise<any> => {\n    const url = `/trending/${filter}/week?page=${pageIndex}`;\n    if (cache.has(url)) {\n      return cache.get(url);\n    }\n\n    const result = api.get(url).then((trending) => {\n      const results = trending.results.filter((r) => !r.adult);\n      const tiles = (\n        leftoverTiles.has(filter) ? leftoverTiles.get(filter) : []\n      ).concat(convertItemsToTiles(results));\n      const chunks = chunkArray(tiles);\n      if (chunks[chunks.length - 1].length < 7) {\n        leftoverTiles.set(filter, chunks.pop());\n      } else {\n        leftoverTiles.delete(filter);\n      }\n      return chunks;\n    });\n\n    cache.set(url, result);\n    return result;\n  };\n}\n","<template>\n  <node id=\"contentBlock\" :style=\"ContentBlockStyle\">\n    <text :style=\"HeadlineStyles\">{{ title }}</text>\n    <text :style=\"DescriptionStyles\">{{ description }}</text>\n  </node>\n</template>\n\n<script setup lang=\"ts\">\ndefineProps({\n  title: String,\n  description: String,\n});\n\nconst blockWidth = 1200;\nconst ContentBlockStyle = {\n  display: \"flex\",\n  flexDirection: \"column\",\n  flexBoundary: \"fixed\",\n  width: blockWidth,\n  height: 220,\n  gap: 16,\n};\n\nconst HeadlineStyles = {\n  fontSize: 50,\n  fontFamily: \"Ubuntu\",\n  fontWeight: 700,\n  maxLines: 1,\n  width: blockWidth,\n  contain: \"width\",\n};\n\nconst DescriptionStyles = {\n  fontSize: 28,\n  fontFamily: \"Ubuntu\",\n  fontWeight: 400,\n  lineHeight: 32,\n  width: blockWidth,\n  maxLines: 3,\n  contain: \"width\",\n};\n</script>\n","<template>\n  <node\n    :onLeft=\"handleLeft\"\n    :onRight=\"handleRight\"\n    :forwardFocus=\"onGridFocus\"\n    :selected=\"props.selected\"\n    :onSelectedChanged=\"selectedChanged\"\n    :style=\"[style, props.style]\"\n  >\n    <slot></slot>\n  </node>\n</template>\n\n<script setup lang=\"ts\">\nimport { handleNavigation, onGridFocus } from \"./utils/handleNavigation\";\nimport { chainFunctions } from \"./utils/chainFunctions\";\nimport { withScrolling } from \"./utils/withScrolling\";\n\nconst props = defineProps({\n  selected: {\n    type: Number,\n    default: 0,\n  },\n  scrollIndex: Number,\n  onLeft: Function,\n  onRight: Function,\n  onLayout: Function,\n  onSelectedChanged: Function,\n  scroll: String,\n  style: Object,\n});\n\nconst handleLeft = chainFunctions(props.onLeft, handleNavigation(\"left\"));\nconst handleRight = chainFunctions(props.onRight, handleNavigation(\"right\"));\nconst selectedChanged = chainFunctions(\n  props.onSelectedChanged,\n  props.scroll !== \"none\" ? withScrolling(props.x) : undefined\n);\n\nconst handleLayout = (elm) => {\n  const scrollFn = withScrolling(props.x);\n  scrollFn.call(elm, elm, elm.children[elm.selected], elm.selected, undefined);\n  if (props.onLayout) props.onLayout(elm);\n};\n\nconst style = {\n  display: \"flex\",\n  flexBoundary: \"fixed\",\n  flexDirection: \"row\",\n  gap: 30,\n  transition: {\n    x: {\n      easing: \"ease-in-out\",\n      duration: 250,\n    },\n  },\n};\n</script>\n","<script setup lang=\"ts\">\nimport browseProvider from \"../api/providers/browse\";\nimport ContentBlock from \"../components/ContentBlock.vue\";\nimport Row from \"../components/Row.vue\";\nimport Column from \"../components/Column.vue\";\nimport NavDrawer from \"../components/NavDrawer.vue\";\nimport { ref, onMounted, watch } from \"vue\";\nimport { activeElement } from \"@lightningtv/vue\";\nimport { debounce } from \"vue-debounce\";\n\nconst alpha = ref(1);\nconst rows = ref([]);\nconst column = ref(null);\nconst navDrawer = ref(null);\nconst globalBackground = ref(\"\");\nconst heroContent = ref({});\nconst bgStyles = {\n  alpha: alpha.value,\n  color: 0xffffffff,\n};\n\nconst Thumbnail = {\n  borderRadius: 16,\n  width: 185,\n  height: 278,\n  scale: 1,\n  zIndex: 2,\n  transition: { scale: { duration: 250, easing: \"ease-in-out\" } },\n  border: { width: 0, color: 0x00000000 },\n  focus: { scale: 1.1, border: { color: 0xffffff66, width: 8 } },\n};\n\nconst delayedBackgrounds = debounce(\n  (img: string) => (globalBackground.value = img),\n  400\n);\nconst delayedHero = debounce(\n  (content: {}) => (heroContent.value = content || {}),\n  200\n);\n\nwatch(\n  () => activeElement.value,\n  (elm, prevFocusedElm) => {\n    if (elm && elm.item) {\n      if (elm.item.backdrop) {\n        delayedBackgrounds(elm.item.backdrop);\n      }\n\n      if (elm.item.heroContent) {\n        delayedHero(elm.item.heroContent);\n      }\n    }\n  }\n);\nonMounted(() => {\n  browseProvider(\"all\")(1).then((data) => {\n    rows.value = data;\n  });\n});\n</script>\n\n<template>\n  <ContentBlock\n    :y=\"250\"\n    :x=\"150\"\n    :title=\"heroContent.title\"\n    :description=\"heroContent.description\"\n  />\n  <Column\n    ref=\"column\"\n    v-if=\"rows.length\"\n    :x=\"150\"\n    :y=\"450\"\n    :width=\"1920\"\n    :height=\"1080\"\n    :autofocus=\"true\"\n    :plinko=\"true\"\n  >\n    <Row\n      v-for=\"row in rows\"\n      :width=\"1620\"\n      :height=\"300\"\n      justifyContent=\"spaceBetween\"\n    >\n      <node\n        v-for=\"item in row\"\n        :style=\"Thumbnail\"\n        :src=\"item.src\"\n        :item=\"item\"\n      />\n    </Row>\n  </Column>\n</template>\n"],"names":["API_KEY_V4","API_BASE","tmdbConfig","baseImageUrl","basePosterSize","defaultFetchParams","getImageUrl","path","posterSize","get","params","_get","loadConfig","r","data","_a","api","truncateString","str","maxLength","chunkArray","array","size","result","i","j","convertItemsToTiles","items","item","cache","leftoverTiles","browseProvider","filter","pageIndex","url","trending","results","tiles","chunks","blockWidth","ContentBlockStyle","HeadlineStyles","DescriptionStyles","props","__props","handleLeft","chainFunctions","handleNavigation","handleRight","selectedChanged","withScrolling","style","alpha","ref","rows","column","globalBackground","heroContent","Thumbnail","delayedBackgrounds","debounce","img","delayedHero","content","watch","activeElement","elm","prevFocusedElm","onMounted"],"mappings":"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"}
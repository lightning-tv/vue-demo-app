var pe=Object.defineProperty;var ge=(s,t,e)=>t in s?pe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>ge(s,typeof t!="symbol"?t+"":t,e);var Re={BASE_URL:"/vue-demo-app/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function Ae(s,t){const e={alpha:!0,antialias:!1,depth:!1,stencil:!0,desynchronized:!1,powerPreference:"high-performance",premultipliedAlpha:!0,preserveDrawingBuffer:!1},r=s.getContext("webgl",e)||s.getContext("experimental-webgl",e);if(!r)throw new Error("Unable to create WebGL context");return t?new Proxy(r,{get(n,i){const o=n[i];return typeof o=="function"?(t.increment(String(i)),o.bind(n)):o}}):r}function R(s,t){if(!me()&&!s)throw new Error(t||"Assertion failed")}function et(s,t,e){const r=Math.trunc(s>>>24),n=Math.trunc(s>>>16&255),i=Math.trunc(s>>>8&255),o=Math.trunc(s&255),h=Math.trunc(t>>>24),c=Math.trunc(t>>>16&255),f=Math.trunc(t>>>8&255),d=Math.trunc(t&255),u=Math.round(h*e+r*(1-e)),T=Math.round(c*e+n*(1-e)),_=Math.round(f*e+i*(1-e)),x=Math.round(d*e+o*(1-e));return(u<<24|T<<16|_<<8|x)>>>0}function tt(s,t){const e=s>>>24,r=s>>>16&255,n=s>>>8&255,i=Math.trunc((s&255)*t);return(e<<24|r<<16|n<<8|i)>>>0}let oe=!0;function rt(s){oe=s==="webgl"}function st(s,t,e=!1){const r=(s&255)/255*t,n=oe?r:1,i=Math.trunc((s>>>24)*n),o=Math.trunc((s>>>16&255)*n),h=Math.trunc((s>>>8&255)*n),c=Math.trunc(r*255);return e?(c<<24|h<<16|o<<8|i)>>>0:(i<<24|o<<16|h<<8|c)>>>0}function Z(s,t){return Object.prototype.hasOwnProperty.call(s,t)}function me(){return Re&&!0}class he{constructor(){a(this,"eventListeners",{})}on(t,e){let r=this.eventListeners[t];r||(r=[]),r.push(e),this.eventListeners[t]=r}off(t,e){const r=this.eventListeners[t];if(!r)return;if(!e){delete this.eventListeners[t];return}const n=r.indexOf(e);n>=0&&r.splice(n,1)}once(t,e){const r=(n,i)=>{this.off(t,r),e(n,i)};this.on(t,r)}emit(t,e){const r=this.eventListeners[t];r&&[...r].forEach(n=>{n(this,e)})}removeAllListeners(){this.eventListeners={}}}class Ie{static makeCacheKey(t){return!1}static resolveDefaults(t){return{}}}function re(s,t,e){const r=s.createShader(t);if(!r)throw new Error;if(s.shaderSource(r,e),s.compileShader(r),s.getShaderParameter(r,s.COMPILE_STATUS))return r;console.log(s.getShaderInfoLog(r)),s.deleteShader(r)}function Me(s,t,e){const r=s.createProgram();if(!r)throw new Error;if(s.attachShader(r,t),s.attachShader(r,e),s.linkProgram(r),s.getProgramParameter(r,s.LINK_STATUS))return r;console.log(s.getProgramInfoLog(r)),s.deleteProgram(r)}function Se(s){return self.WebGL2RenderingContext&&s instanceof self.WebGL2RenderingContext}class ce extends Ie{constructor(e){super();a(this,"boundBufferCollection",null);a(this,"buffersBound",!1);a(this,"program");a(this,"vao");a(this,"renderer");a(this,"glw");a(this,"attributeBuffers");a(this,"attributeLocations");a(this,"attributeNames");a(this,"uniformLocations");a(this,"uniformTypes");a(this,"supportsIndexedTextures");const r=this.renderer=e.renderer,n=this.glw=this.renderer.glw;this.supportsIndexedTextures=e.supportsIndexedTextures||!1;const i=n.isWebGl2(),o=i&&e.webgl2Extensions||!i&&e.webgl1Extensions||[],h=i?"2.0":"1.0";o.forEach(E=>{if(!n.getExtension(E))throw new Error(`Shader "${this.constructor.name}" requires extension "${E}" for WebGL ${h} but wasn't found`)});const c=e.shaderSources||this.constructor.shaderSources;if(c)i&&(c!=null&&c.webGl2)&&(c.fragment=c.webGl2.fragment,c.vertex=c.webGl2.vertex,delete c.webGl2);else throw new Error(`Shader "${this.constructor.name}" is missing shaderSources.`);const f=r.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,d=c.vertex instanceof Function?c.vertex(f):c.vertex,u=c.fragment instanceof Function?c.fragment(f):c.fragment,T=re(n,n.VERTEX_SHADER,d),_=re(n,n.FRAGMENT_SHADER,u);if(!T||!_)throw new Error;const x=Me(n,T,_);if(!x)throw new Error;if(this.program=x,i){const E=n.createVertexArray();if(!E)throw new Error;this.vao=E,n.bindVertexArray(this.vao)}this.attributeLocations={},this.attributeBuffers={},this.attributeNames=[],[...e.attributes].forEach(E=>{const p=n.getAttribLocation(this.program,E);if(p<0)throw new Error(`${this.constructor.name}: Vertex shader must have an attribute "${E}"!`);const g=n.createBuffer();if(!g)throw new Error(`${this.constructor.name}: Could not create buffer for attribute "${E}"`);this.attributeLocations[E]=p,this.attributeBuffers[E]=g,this.attributeNames.push(E)}),this.uniformLocations={},this.uniformTypes={},e.uniforms.forEach(E=>{const p=n.getUniformLocation(this.program,E.name);if(this.uniformTypes[E.name]=E.uniform,!p){console.warn(`Shader "${this.constructor.name}" could not get uniform location for "${E.name}"`);return}this.uniformLocations[E.name]=p})}bindBufferAttribute(e,r,n){const{glw:i}=this;i.enableVertexAttribArray(e),i.vertexAttribPointer(r,e,n.size,n.type,n.normalized,n.stride,n.offset)}disableAttribute(e){this.glw.disableVertexAttribArray(e)}disableAttributes(){for(const e in this.attributeLocations)this.disableAttribute(this.attributeLocations[e]);this.boundBufferCollection=null}canBatchShaderProps(e,r){return!1}bindRenderOp(e,r){this.bindBufferCollection(e.buffers),e.textures.length>0&&this.bindTextures(e.textures);const{glw:n,parentHasRenderTexture:i,renderToTexture:o}=e;if(!(o&&i)){if(i){const{width:h,height:c}=e.framebufferDimensions||{};this.setUniform("u_pixelRatio",1),this.setUniform("u_resolution",new Float32Array([h??0,c??0]))}else this.setUniform("u_pixelRatio",e.options.pixelRatio),this.setUniform("u_resolution",new Float32Array([n.canvas.width,n.canvas.height]));if(r){if(Z(r,"$dimensions")){let h=r.$dimensions;h||(h=e.dimensions),this.setUniform("u_dimensions",[h.width,h.height])}if(Z(r,"$alpha")){let h=r.$alpha;h||(h=e.alpha),this.setUniform("u_alpha",h)}this.bindProps(r)}}}setUniform(e,...r){this.glw.setUniform(this.uniformTypes[e],this.uniformLocations[e],...r)}bindBufferCollection(e){if(this.boundBufferCollection!==e){for(const r in this.attributeLocations){const n=e.getBuffer(r),i=e.getAttributeInfo(r);R(n,`Buffer for "${r}" not found`),R(i),this.bindBufferAttribute(this.attributeLocations[r],n,i)}this.boundBufferCollection=e}}bindProps(e){}bindTextures(e){}attach(){this.glw.useProgram(this.program),this.glw.useProgram(this.program),this.glw.isWebGl2()&&this.vao&&this.glw.bindVertexArray(this.vao)}detach(){this.disableAttributes()}}a(ce,"shaderSources");class v extends he{constructor(e){super();a(this,"txManager");a(this,"dimensions",null);a(this,"error",null);a(this,"state","freed");a(this,"renderableOwners",new Set);this.txManager=e}setRenderableOwner(e,r){r?this.renderableOwners.add(e):this.renderableOwners.delete(e)}get renderable(){return this.renderableOwners.size>0}setState(e,...r){if(this.state!==e){if(this.state=e,e==="loaded"){const n=r;this.dimensions=n[0]}else if(e==="failed"){const n=r;this.error=n[0]}this.emit(e,...r)}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{}}}const ye=/^(data|ftps?|https?):/,be=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,n=s&255;return[t/255,e/255,r/255,n/255]},nt=s=>{const t=s>>>24,e=s>>>16&255,r=s>>>8&255,n=s&255;return[t,e,r,n]};function it(s){return(s&255)/255}function at(s){const t=Math.floor(s[0]*255),e=Math.floor(s[1]*255),r=Math.floor(s[2]*255),n=Math.floor(s[3]*255);return`rgba(${t},${e},${r},${n.toFixed(4)})`}function se(s,t,e,r,n){return n?(n.x1=s,n.y1=t,n.x2=e,n.y2=r,n):{x1:s,y1:t,x2:e,y2:r}}function ot(s,t,e){const r=se(Math.max(s.x1,t.x1),Math.max(s.y1,t.y1),Math.min(s.x2,t.x2),Math.min(s.y2,t.y2),e);return r.x1<r.x2&&r.y1<r.y2?r:se(0,0,0,0,r)}function ht(s,t){return s.x1<t.x2&&s.x2>t.x1&&s.y1<t.y2&&s.y2>t.y1}function ct(s,t){return t?(t.x=s.x1,t.y=s.y1,t.width=s.x2-s.x1,t.height=s.y2-s.y1,t):{x:s.x1,y:s.y1,width:s.x2-s.x1,height:s.y2-s.y1}}function ut(s,t,e){const r=Math.max(s.x,t.x),n=Math.max(s.y,t.y),i=Math.min(s.x+s.width,t.x+t.width)-r,o=Math.min(s.y+s.height,t.y+t.height)-n;return i>0&&o>0?e?(e.x=r,e.y=n,e.width=i,e.height=o,e):{x:r,y:n,width:i,height:o}:e?(e.x=0,e.y=0,e.width=0,e.height=0,e):{x:0,y:0,width:0,height:0}}function lt(s,t){return t?(t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height,t):{x:s.x,y:s.y,width:s.width,height:s.height}}function we(s,t){return s===t?!0:s===null||t===null?!1:s.x===t.x&&s.y===t.y&&s.width===t.width&&s.height===t.height}function ft(s,t){return s.x1<=t.x2&&s.y1<=t.y2&&s.x2>=t.x1&&s.y2>=t.y1}function dt(s){return s.x1<s.x2&&s.y1<s.y2}function Ue(s){if(self.location.protocol==="file:"&&!ye.test(s)){const e=self.location.pathname.split("/");e.pop();const r=e.join("/"),n=self.location.protocol+"//"+r;return s.charAt(0)==="."&&(s=s.slice(1)),s.charAt(0)==="/"&&(s=s.slice(1)),n+"/"+s}return new URL(s,self.location.href).href}class Le extends he{constructor(e){super();a(this,"fontFamily");a(this,"descriptors");a(this,"loaded",!1);a(this,"metrics",null);const{fontFamily:r,descriptors:n,metrics:i}=e;i&&(this.metrics={ascender:i.ascender/i.unitsPerEm,descender:i.descender/i.unitsPerEm,lineGap:i.lineGap/i.unitsPerEm}),this.fontFamily=r,this.descriptors={style:"normal",weight:"normal",stretch:"normal",...n}}static convertToCssFontFaceDescriptors(e){return{style:e.style,weight:typeof e.weight=="number"?`${e.weight}`:e.weight,stretch:e.stretch,unicodeRange:e.unicodeRange,variant:e.variant,featureSettings:e.featureSettings,display:e.display}}}const O=class O extends v{constructor(e,r){super(e);a(this,"props");this.props=O.resolveDefaults(r||{})}get color(){return this.props.color}set color(e){this.props.color=e}async getTextureData(){const e=new Uint32Array([this.color]),r=new Uint8ClampedArray(e.buffer);return{data:new ImageData(r,1,1),premultiplyAlpha:!0}}static makeCacheKey(e){return`ColorTexture,${O.resolveDefaults(e).color}`}static resolveDefaults(e){return{color:e.color||4294967295}}};a(O,"z$__type__Props");let Q=O;class Ne{constructor(t,e){a(this,"memManager");a(this,"textureSource");this.memManager=t,this.textureSource=e}}class Pe{constructor(t){a(this,"options");a(this,"mode");a(this,"stage");a(this,"txManager");a(this,"txMemManager");a(this,"shManager");a(this,"rttNodes",[]);this.options=t,this.stage=t.stage,this.txManager=t.txManager,this.txMemManager=t.txMemManager,this.shManager=t.shManager}}class Ce{}class Be extends Ce{constructor(e,r,n,i,o,h,c,f,d,u,T,_,x){super();a(this,"glw");a(this,"options");a(this,"buffers");a(this,"shader");a(this,"shaderProps");a(this,"alpha");a(this,"clippingRect");a(this,"dimensions");a(this,"bufferIdx");a(this,"zIndex");a(this,"renderToTexture");a(this,"parentHasRenderTexture");a(this,"framebufferDimensions");a(this,"length",0);a(this,"numQuads",0);a(this,"textures",[]);a(this,"maxTextures");this.glw=e,this.options=r,this.buffers=n,this.shader=i,this.shaderProps=o,this.alpha=h,this.clippingRect=c,this.dimensions=f,this.bufferIdx=d,this.zIndex=u,this.renderToTexture=T,this.parentHasRenderTexture=_,this.framebufferDimensions=x,this.maxTextures=i.supportsIndexedTextures?e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS):1}addTexture(e){const{textures:r,maxTextures:n}=this,i=r.findIndex(h=>h===e);if(i!==-1)return i;const o=r.length;return o>=n?4294967295:(this.textures.push(e),o)}draw(){const{glw:e,shader:r,shaderProps:n,options:i}=this,{shManager:o}=i;o.useShader(r),r.bindRenderOp(this,n);const h=this.bufferIdx/24*6*2;if(this.clippingRect.valid){const{x:c,y:f,width:d,height:u}=this.clippingRect,T=i.pixelRatio,_=i.canvas.height,x=Math.round(c*T),E=Math.round(d*T),p=Math.round(u*T),g=Math.round(_-p-f*T);e.setScissorTest(!0),e.scissor(x,g,E,p)}else e.setScissorTest(!1);e.drawElements(e.TRIANGLES,6*this.numQuads,e.UNSIGNED_SHORT,h)}}function De(s){const t={MAX_RENDERBUFFER_SIZE:0,MAX_TEXTURE_SIZE:0,MAX_VIEWPORT_DIMS:0,MAX_VERTEX_TEXTURE_IMAGE_UNITS:0,MAX_TEXTURE_IMAGE_UNITS:0,MAX_COMBINED_TEXTURE_IMAGE_UNITS:0,MAX_VERTEX_ATTRIBS:0,MAX_VARYING_VECTORS:0,MAX_VERTEX_UNIFORM_VECTORS:0,MAX_FRAGMENT_UNIFORM_VECTORS:0};return Object.keys(t).forEach(r=>{t[r]=s.getParameter(s[r])}),t}function Oe(s){const t={ANGLE_instanced_arrays:null,WEBGL_compressed_texture_s3tc:null,WEBGL_compressed_texture_astc:null,WEBGL_compressed_texture_etc:null,WEBGL_compressed_texture_etc1:null,WEBGL_compressed_texture_pvrtc:null,WEBKIT_WEBGL_compressed_texture_pvrtc:null,WEBGL_compressed_texture_s3tc_srgb:null,OES_vertex_array_object:null};return Object.keys(t).forEach(r=>{t[r]=s.getExtension(r)}),t}function Ge(s,t){const e=~~(t/80),r=new Uint16Array(e*6);for(let i=0,o=0;i<e;i+=6,o+=4)r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+2,r[i+4]=o+1,r[i+5]=o+3;const n=s.createBuffer();s.elementArrayBufferData(n,r,s.STATIC_DRAW)}function ve(s){return s!==null&&typeof s=="object"&&s.constructor&&s.constructor.name==="HTMLImageElement"}const ne=s=>s&&!(s&s-1),ue=(s,t,e,r)=>{const n=3*s,i=3*(e-s)-n,o=1-n-i,h=3*t,c=3*(r-t)-h,f=1-h-c;return function(d){if(d>=1)return 1;if(d<=0)return 0;let u=.5,T,_,x;for(let g=0;g<20;g++){if(T=u*(u*(u*o+i)+n),x=d-T,x>-1e-8&&x<1e-8)return u*(u*(u*f+c)+h);if(_=u*(u*(3*o)+2*i)+n,_>1e-10&&_<1e-10)break;u+=x/_}let E=0,p=1;for(let g=0;g<20;g++){if(u=.5*(E+p),T=u*(u*(u*o+i)+n),x=d-T,x>-1e-8&&x<1e-8)return u*(u*(u*f+c)+h);x<0?p=u:E=u}}},X={},ie={ease:[.25,.1,.25,1],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1],"ease-in-sine":[.12,0,.39,0],"ease-out-sine":[.12,0,.39,0],"ease-in-out-sine":[.37,0,.63,1],"ease-in-cubic":[.32,0,.67,0],"ease-out-cubic":[.33,1,.68,1],"ease-in-out-cubic":[.65,0,.35,1],"ease-in-circ":[.55,0,1,.45],"ease-out-circ":[0,.55,.45,1],"ease-in-out-circ":[.85,0,.15,1],"ease-in-back":[.36,0,.66,-.56],"ease-out-back":[.34,1.56,.64,1],"ease-in-out-back":[.68,-.6,.32,1.6]},W=s=>s,Fe=s=>{const t=/-?\d*\.?\d+/g,e=s.match(t);if(e){const[r,n,i,o]=e,h=parseFloat(r||"0.42"),c=parseFloat(n||"0"),f=parseFloat(i||"1"),d=parseFloat(o||"1"),u=ue(h,c,f,d);return X[s]=u,u}return console.warn("Unknown cubic-bezier timing: "+s),W},Tt=s=>{if(s==="linear")return W;if(X[s]!==void 0)return X[s]||W;if(s==="step-start")return()=>1;if(s==="step-end")return t=>t===1?1:0;if(ie[s]!==void 0){const[t,e,r,n]=ie[s],i=ue(t,e,r,n);return X[s]=i,i}return s.startsWith("cubic-bezier")?Fe(s):(console.warn("Unknown timing function: "+s),W)};Math.hypot||(Math.hypot=(...s)=>{let t=0,e=s.length;for(;e--;)t+=s[e]*s[e];return Math.sqrt(t)});const q=new Uint8Array([0,0,0,0]);class H extends Ne{constructor(e,r,n){super(r,n);a(this,"glw");a(this,"_nativeCtxTexture",null);a(this,"_state","freed");a(this,"_w",0);a(this,"_h",0);this.glw=e}get ctxTexture(){return this._state==="freed"&&this.load(),R(this._nativeCtxTexture),this._nativeCtxTexture}get renderable(){return this.textureSource.renderable}get w(){return this._w}get h(){return this._h}load(){this._state==="loading"||this._state==="loaded"||(this._state="loading",this.textureSource.setState("loading"),this._nativeCtxTexture=this.createNativeCtxTexture(),this.onLoadRequest().then(({width:e,height:r})=>{this._state!=="freed"&&(this._state="loaded",this._w=e,this._h=r,this.textureSource.setState("loaded",{width:e,height:r}))}).catch(e=>{this._state!=="freed"&&(this._state="failed",this.textureSource.setState("failed",e),console.error(e))}))}async onLoadRequest(){var h;const{glw:e,memManager:r}=this;e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),r.setTextureMemUse(this,q.byteLength);const n=await((h=this.textureSource)==null?void 0:h.getTextureData());if(!this._nativeCtxTexture)return R(this._state==="freed"),{width:0,height:0};let i=0,o=0;if(R(this._nativeCtxTexture),e.activeTexture(0),n.data instanceof ImageBitmap||n.data instanceof ImageData||ve(n.data)){const c=n.data;i=c.width,o=c.height,e.bindTexture(this._nativeCtxTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!!n.premultiplyAlpha),e.texImage2D(0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c),r.setTextureMemUse(this,i*o*4),(e.isWebGl2()||ne(i)&&ne(o))&&e.generateMipmap()}else if(n.data===null)i=0,o=0,e.bindTexture(this._nativeCtxTexture),e.texImage2D(0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,q),r.setTextureMemUse(this,q.byteLength);else if("mipmaps"in n.data&&n.data.mipmaps){const{mipmaps:c,width:f=0,height:d=0,type:u,glInternalFormat:T}=n.data,_=u==="ktx"?new DataView(c[0]??new ArrayBuffer(0)):c[0];e.bindTexture(this._nativeCtxTexture),e.compressedTexImage2D(0,T,f,d,0,_),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),r.setTextureMemUse(this,_.byteLength)}else console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned",n);return{width:i,height:o}}free(){if(this._state==="freed"||(this._state="freed",this.textureSource.setState("freed"),this._w=0,this._h=0,!this._nativeCtxTexture))return;const{glw:e,memManager:r}=this;e.deleteTexture(this._nativeCtxTexture),r.setTextureMemUse(this,0),this._nativeCtxTexture=null}createNativeCtxTexture(){const{glw:e}=this,r=e.createTexture();if(!r)throw new Error("Could not create WebGL Texture");return e.activeTexture(0),e.bindTexture(r),e.texParameteri(e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r}}const Y=class Y extends v{constructor(e,r){super(e);a(this,"props");a(this,"parentTexture");a(this,"onParentTxLoaded",()=>{this.setState("loaded",{width:this.props.width,height:this.props.height})});a(this,"onParentTxFailed",(e,r)=>{this.setState("failed",r)});this.parentTexture=this.txManager.loadTexture(r.texture.txType,r.texture.props,r.texture.options),this.props=Y.resolveDefaults(r||{}),queueMicrotask(()=>{const n=this.parentTexture;n.state==="loaded"?this.onParentTxLoaded(n,n.dimensions):n.state==="failed"&&this.onParentTxFailed(n,n.error),n.on("loaded",this.onParentTxLoaded),n.on("failed",this.onParentTxFailed)})}async getTextureData(){return{data:this.props}}static makeCacheKey(e){return!1}static resolveDefaults(e){return{texture:e.texture,x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}};a(Y,"z$__type__Props");let V=Y;class Xe extends H{constructor(t,e,r){super(t,e,r)}async onLoadRequest(){var e,r;const t=await this.textureSource.getTextureData();return{width:((e=t.data)==null?void 0:e.width)||0,height:((r=t.data)==null?void 0:r.height)||0}}}class We{constructor(t){a(this,"config");this.config=t}getBuffer(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.buffer}getAttributeInfo(t){var e;return(e=this.config.find(r=>r.attributes[t]))==null?void 0:e.attributes[t]}}class He{constructor(t){a(this,"gl");a(this,"activeTextureUnit",0);a(this,"texture2dUnits");a(this,"texture2dParams",new WeakMap);a(this,"scissorEnabled");a(this,"scissorX");a(this,"scissorY");a(this,"scissorWidth");a(this,"scissorHeight");a(this,"blendEnabled");a(this,"blendSrcRgb");a(this,"blendDstRgb");a(this,"blendSrcAlpha");a(this,"blendDstAlpha");a(this,"boundArrayBuffer");a(this,"boundElementArrayBuffer");a(this,"curProgram");a(this,"programUniforms",new WeakMap);a(this,"canvas");a(this,"MAX_RENDERBUFFER_SIZE");a(this,"MAX_TEXTURE_SIZE");a(this,"MAX_VIEWPORT_DIMS");a(this,"MAX_VERTEX_TEXTURE_IMAGE_UNITS");a(this,"MAX_TEXTURE_IMAGE_UNITS");a(this,"MAX_COMBINED_TEXTURE_IMAGE_UNITS");a(this,"MAX_VERTEX_ATTRIBS");a(this,"MAX_VARYING_VECTORS");a(this,"MAX_VERTEX_UNIFORM_VECTORS");a(this,"MAX_FRAGMENT_UNIFORM_VECTORS");a(this,"TEXTURE_MAG_FILTER");a(this,"TEXTURE_MIN_FILTER");a(this,"TEXTURE_WRAP_S");a(this,"TEXTURE_WRAP_T");a(this,"LINEAR");a(this,"CLAMP_TO_EDGE");a(this,"RGBA");a(this,"UNSIGNED_BYTE");a(this,"UNPACK_PREMULTIPLY_ALPHA_WEBGL");a(this,"UNPACK_FLIP_Y_WEBGL");a(this,"FLOAT");a(this,"TRIANGLES");a(this,"UNSIGNED_SHORT");a(this,"ONE");a(this,"ONE_MINUS_SRC_ALPHA");a(this,"VERTEX_SHADER");a(this,"FRAGMENT_SHADER");a(this,"STATIC_DRAW");a(this,"COMPILE_STATUS");a(this,"LINK_STATUS");a(this,"DYNAMIC_DRAW");a(this,"COLOR_ATTACHMENT0");this.gl=t,this.activeTextureUnit=t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0;const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.texture2dUnits=new Array(e).fill(void 0).map((n,i)=>(this.activeTexture(i),t.getParameter(t.TEXTURE_BINDING_2D))),this.activeTexture(this.activeTextureUnit),this.scissorEnabled=t.isEnabled(t.SCISSOR_TEST);const r=t.getParameter(t.SCISSOR_BOX);this.scissorX=r[0],this.scissorY=r[1],this.scissorWidth=r[2],this.scissorHeight=r[3],this.blendEnabled=t.isEnabled(t.BLEND),this.blendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),this.blendDstRgb=t.getParameter(t.BLEND_DST_RGB),this.blendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),this.blendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),this.boundArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),this.boundElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),this.curProgram=t.getParameter(t.CURRENT_PROGRAM),this.canvas=t.canvas,this.MAX_RENDERBUFFER_SIZE=t.MAX_RENDERBUFFER_SIZE,this.MAX_TEXTURE_SIZE=t.MAX_TEXTURE_SIZE,this.MAX_VIEWPORT_DIMS=t.MAX_VIEWPORT_DIMS,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_IMAGE_UNITS,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS,this.MAX_VERTEX_ATTRIBS=t.MAX_VERTEX_ATTRIBS,this.MAX_VARYING_VECTORS=t.MAX_VARYING_VECTORS,this.MAX_VERTEX_UNIFORM_VECTORS=t.MAX_VERTEX_UNIFORM_VECTORS,this.MAX_FRAGMENT_UNIFORM_VECTORS=t.MAX_FRAGMENT_UNIFORM_VECTORS,this.TEXTURE_MAG_FILTER=t.TEXTURE_MAG_FILTER,this.TEXTURE_MIN_FILTER=t.TEXTURE_MIN_FILTER,this.TEXTURE_WRAP_S=t.TEXTURE_WRAP_S,this.TEXTURE_WRAP_T=t.TEXTURE_WRAP_T,this.LINEAR=t.LINEAR,this.CLAMP_TO_EDGE=t.CLAMP_TO_EDGE,this.RGBA=t.RGBA,this.UNSIGNED_BYTE=t.UNSIGNED_BYTE,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.UNPACK_FLIP_Y_WEBGL=t.UNPACK_FLIP_Y_WEBGL,this.FLOAT=t.FLOAT,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.ONE=t.ONE,this.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=t.MAX_VERTEX_TEXTURE_IMAGE_UNITS,this.TRIANGLES=t.TRIANGLES,this.UNSIGNED_SHORT=t.UNSIGNED_SHORT,this.VERTEX_SHADER=t.VERTEX_SHADER,this.FRAGMENT_SHADER=t.FRAGMENT_SHADER,this.STATIC_DRAW=t.STATIC_DRAW,this.COMPILE_STATUS=t.COMPILE_STATUS,this.LINK_STATUS=t.LINK_STATUS,this.DYNAMIC_DRAW=t.DYNAMIC_DRAW,this.COLOR_ATTACHMENT0=t.COLOR_ATTACHMENT0}isWebGl2(){return Se(this.gl)}activeTexture(t){const{gl:e}=this;this.activeTextureUnit!==t&&(e.activeTexture(t+e.TEXTURE0),this.activeTextureUnit=t)}bindTexture(t){const{gl:e,activeTextureUnit:r,texture2dUnits:n}=this;n[r]!==t&&(n[r]=t,e.bindTexture(this.gl.TEXTURE_2D,t))}_getActiveTexture(){const{activeTextureUnit:t,texture2dUnits:e}=this;return e[t]}texParameteri(t,e){const{gl:r,texture2dParams:n}=this,i=this._getActiveTexture();if(!i)throw new Error("No active texture");let o=n.get(i);o||(o={},n.set(i,o)),o[t]!==e&&(o[t]=e,r.texParameteri(r.TEXTURE_2D,t,e))}texImage2D(t,e,r,n,i,o,h,c){const{gl:f}=this;o?f.texImage2D(f.TEXTURE_2D,t,e,r,n,i,o,h,c):f.texImage2D(f.TEXTURE_2D,t,e,r,n,i)}compressedTexImage2D(t,e,r,n,i,o){const{gl:h}=this;h.compressedTexImage2D(h.TEXTURE_2D,t,e,r,n,i,o)}pixelStorei(t,e){const{gl:r}=this;r.pixelStorei(t,e)}generateMipmap(){const{gl:t}=this;t.generateMipmap(t.TEXTURE_2D)}createTexture(){const{gl:t}=this;return t.createTexture()}deleteTexture(t){const{gl:e}=this;t&&this.texture2dParams.delete(t),e.deleteTexture(t)}viewport(t,e,r,n){const{gl:i}=this;i.viewport(t,e,r,n)}clearColor(t,e,r,n){const{gl:i}=this;i.clearColor(t,e,r,n)}setScissorTest(t){const{gl:e,scissorEnabled:r}=this;t!==r&&(t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.scissorEnabled=t)}scissor(t,e,r,n){const{gl:i,scissorX:o,scissorY:h,scissorWidth:c,scissorHeight:f}=this;(t!==o||e!==h||r!==c||n!==f)&&(i.scissor(t,e,r,n),this.scissorX=t,this.scissorY=e,this.scissorWidth=r,this.scissorHeight=n)}setBlend(t){const{gl:e,blendEnabled:r}=this;t!==r&&(t?e.enable(e.BLEND):e.disable(e.BLEND),this.blendEnabled=t)}blendFunc(t,e){const{gl:r,blendSrcRgb:n,blendDstRgb:i,blendSrcAlpha:o,blendDstAlpha:h}=this;(t!==n||e!==i||t!==o||e!==h)&&(r.blendFunc(t,e),this.blendSrcRgb=t,this.blendDstRgb=e,this.blendSrcAlpha=t,this.blendDstAlpha=e)}createBuffer(){const{gl:t}=this;return t.createBuffer()}createFramebuffer(){const{gl:t}=this;return t.createFramebuffer()}bindFramebuffer(t){const{gl:e}=this;e.bindFramebuffer(e.FRAMEBUFFER,t)}framebufferTexture2D(t,e,r){const{gl:n}=this;n.framebufferTexture2D(n.FRAMEBUFFER,t,n.TEXTURE_2D,e,r)}clear(){const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}arrayBufferData(t,e,r){const{gl:n,boundArrayBuffer:i}=this;i!==t&&(n.bindBuffer(n.ARRAY_BUFFER,t),this.boundArrayBuffer=t),n.bufferData(n.ARRAY_BUFFER,e,r)}elementArrayBufferData(t,e,r){const{gl:n,boundElementArrayBuffer:i}=this;i!==t&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.boundElementArrayBuffer=t),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,r)}vertexAttribPointer(t,e,r,n,i,o,h){const{gl:c,boundArrayBuffer:f}=this;f!==t&&(c.bindBuffer(c.ARRAY_BUFFER,t),this.boundArrayBuffer=t),c.vertexAttribPointer(e,r,n,i,o,h)}useProgram(t){const{gl:e,curProgram:r}=this;r!==t&&(e.useProgram(t),this.curProgram=t)}setUniform(t,e,...r){const{gl:n,programUniforms:i}=this;let o=i.get(this.curProgram);o||(o=new Map,i.set(this.curProgram,o));const h=o.get(e);(!h||!Ve(h,r))&&(o.set(e,r),n[t](e,...r))}getParameter(t){const{gl:e}=this;return e.getParameter(t)}drawElements(t,e,r,n){const{gl:i}=this;i.drawElements(t,e,r,n)}getExtension(t){const{gl:e}=this;return e.getExtension(t)}createVertexArray(){const{gl:t}=this;return R(t instanceof WebGL2RenderingContext),t.createVertexArray()}bindVertexArray(t){const{gl:e}=this;R(e instanceof WebGL2RenderingContext),e.bindVertexArray(t)}getAttribLocation(t,e){const{gl:r}=this;return r.getAttribLocation(t,e)}getUniformLocation(t,e){const{gl:r}=this;return r.getUniformLocation(t,e)}enableVertexAttribArray(t){const{gl:e}=this;e.enableVertexAttribArray(t)}disableVertexAttribArray(t){const{gl:e}=this;e.disableVertexAttribArray(t)}createShader(t){const{gl:e}=this;return e.createShader(t)}compileShader(t){const{gl:e}=this;e.compileShader(t)}attachShader(t,e){const{gl:r}=this;r.attachShader(t,e)}linkProgram(t){const{gl:e}=this;e.linkProgram(t)}deleteProgram(t){const{gl:e}=this;e.deleteProgram(t)}getShaderParameter(t,e){const{gl:r}=this;return r.getShaderParameter(t,e)}getShaderInfoLog(t){const{gl:e}=this;return e.getShaderInfoLog(t)}createProgram(){const{gl:t}=this;return t.createProgram()}getProgramParameter(t,e){const{gl:r}=this;return r.getProgramParameter(t,e)}getProgramInfoLog(t){const{gl:e}=this;return e.getProgramInfoLog(t)}shaderSource(t,e){const{gl:r}=this;r.shaderSource(t,e)}deleteShader(t){const{gl:e}=this;e.deleteShader(t)}}function Ve(s,t){return s.length!==t.length?!1:s.every((e,r)=>Array.isArray(e)||e instanceof Float32Array?!1:e===t[r])}const k=class k extends v{constructor(e,r){super(e);a(this,"props");this.props=k.resolveDefaults(r||{})}get width(){return this.props.width}set width(e){this.props.width=e}get height(){return this.props.height}set height(e){this.props.height=e}async getTextureData(){return{data:null,premultiplyAlpha:null}}static resolveDefaults(e){return{width:e.width||256,height:e.height||256}}};a(k,"z$__type__Props");let j=k;class ae extends H{constructor(e,r,n){super(e,r,n);a(this,"framebuffer");const i=e.createFramebuffer();R(i,"Unable to create framebuffer"),this.framebuffer=i}async onLoadRequest(){const{glw:e,memManager:r}=this,n=this._nativeCtxTexture=this.createNativeCtxTexture(),{width:i,height:o}=this.textureSource;return e.texImage2D(0,e.RGBA,i,o,0,e.RGBA,e.UNSIGNED_BYTE,null),r.setTextureMemUse(this,i*o*4),e.bindFramebuffer(this.framebuffer),e.framebufferTexture2D(e.COLOR_ATTACHMENT0,n,0),e.bindFramebuffer(null),{width:i,height:o}}}function Ye(s){return/\.(ktx|pvr)$/.test(s)}const ke=async s=>{const e=await(await fetch(s)).arrayBuffer();return s.indexOf(".ktx")!==-1?$e(e):ze(e)},$e=async s=>{const t=new DataView(s),e=t.getUint32(12)===16909060,r=[],n={glInternalFormat:t.getUint32(28,e),pixelWidth:t.getUint32(36,e),pixelHeight:t.getUint32(40,e),numberOfMipmapLevels:t.getUint32(56,e),bytesOfKeyValueData:t.getUint32(60,e)};let i=64;i+=n.bytesOfKeyValueData;for(let o=0;o<n.numberOfMipmapLevels;o++){const h=t.getUint32(i);i+=4,r.push(t.buffer.slice(i,h)),i+=h}return{data:{glInternalFormat:n.glInternalFormat,mipmaps:r,width:n.pixelWidth||0,height:n.pixelHeight||0,type:"ktx"},premultiplyAlpha:!1}},ze=async s=>{const h=s,c=new Int32Array(h,0,13),f=c[12]+52,d=new Uint8Array(h,f),u=[],T={pixelWidth:c[7],pixelHeight:c[6],numberOfMipmapLevels:c[11]||0};let _=0,x=T.pixelWidth||0,E=T.pixelHeight||0;for(let p=0;p<T.numberOfMipmapLevels;p++){const g=(x+3>>2)*(E+3>>2)*8,N=new Uint8Array(h,d.byteOffset+_,g);u.push(N),_+=g,x=x>>1,E=E>>1}return{data:{glInternalFormat:36196,mipmaps:u,width:T.pixelWidth||0,height:T.pixelHeight||0,type:"pvr"},premultiplyAlpha:!1}},G=class G extends v{constructor(e,r){super(e);a(this,"props");this.props=G.resolveDefaults(r)}hasAlphaChannel(e){return e.indexOf("image/png")!==-1}async getTextureData(){const{src:e,premultiplyAlpha:r}=this.props;if(!e)return{data:null};if(typeof e!="string")return e instanceof ImageData?{data:e,premultiplyAlpha:r}:{data:e(),premultiplyAlpha:r};if(Ye(e))return ke(e);const n=Ue(e);if(this.txManager.imageWorkerManager)return await this.txManager.imageWorkerManager.getImage(n,r);if(this.txManager.hasCreateImageBitmap){const o=await(await fetch(n)).blob(),h=r??this.hasAlphaChannel(o.type);return{data:await createImageBitmap(o,{premultiplyAlpha:h?"premultiply":"none",colorSpaceConversion:"none",imageOrientation:"none"}),premultiplyAlpha:h}}else{const i=new Image;return e.substr(0,5)!=="data:"&&(i.crossOrigin="Anonymous"),i.src=n,await new Promise((o,h)=>{i.onload=()=>o(),i.onerror=()=>h(new Error("Failed to load image"))}).catch(o=>{console.error(o)}),{data:i,premultiplyAlpha:r??!0}}}static makeCacheKey(e){const r=G.resolveDefaults(e),n=r.key||r.src;return typeof n!="string"?!1:`ImageTexture,${n},${r.premultiplyAlpha??"true"}`}static resolveDefaults(e){return{src:e.src??"",premultiplyAlpha:e.premultiplyAlpha??!0,key:e.key??null}}};a(G,"z$__type__Props");let J=G;const Ke=24;class qe extends Pe{constructor(e){super(e);a(this,"glw");a(this,"system");a(this,"quadBuffer",new ArrayBuffer(1024*1024*4));a(this,"fQuadBuffer",new Float32Array(this.quadBuffer));a(this,"uiQuadBuffer",new Uint32Array(this.quadBuffer));a(this,"renderOps",[]);a(this,"curBufferIdx",0);a(this,"curRenderOp",null);a(this,"rttNodes",[]);a(this,"activeRttNode",null);a(this,"defaultShader");a(this,"quadBufferCollection");a(this,"defaultTexture");a(this,"renderToTextureActive",!1);this.mode="webgl";const{canvas:r,clearColor:n,bufferMemory:i}=e;this.defaultTexture=new Q(this.txManager),this.defaultTexture.setRenderableOwner(this,!0),this.defaultTexture.once("loaded",()=>{this.stage.requestRender()});const o=Ae(r,e.contextSpy),h=this.glw=new He(o),c=be(n);h.viewport(0,0,r.width,r.height),h.clearColor(c[0],c[1],c[2],c[3]),h.setBlend(!0),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),Ge(h,i),this.system={parameters:De(this.glw),extensions:Oe(this.glw)},this.shManager.renderer=this,this.defaultShader=this.shManager.loadShader("DefaultShader").shader;const f=h.createBuffer();R(f);const d=6*Float32Array.BYTES_PER_ELEMENT;this.quadBufferCollection=new We([{buffer:f,attributes:{a_position:{name:"a_position",size:2,type:h.FLOAT,normalized:!1,stride:d,offset:0},a_textureCoordinate:{name:"a_textureCoordinate",size:2,type:h.FLOAT,normalized:!1,stride:d,offset:2*Float32Array.BYTES_PER_ELEMENT},a_color:{name:"a_color",size:4,type:h.UNSIGNED_BYTE,normalized:!0,stride:d,offset:4*Float32Array.BYTES_PER_ELEMENT},a_textureIndex:{name:"a_textureIndex",size:1,type:h.FLOAT,normalized:!1,stride:d,offset:5*Float32Array.BYTES_PER_ELEMENT}}}])}reset(){const{glw:e}=this;this.curBufferIdx=0,this.curRenderOp=null,this.renderOps.length=0,e.setScissorTest(!1),e.clear()}getShaderManager(){return this.shManager}createCtxTexture(e){return e instanceof V?new Xe(this.glw,this.txMemManager,e):e instanceof j?new ae(this.glw,this.txMemManager,e):new H(this.glw,this.txMemManager,e)}addQuad(e){const{fQuadBuffer:r,uiQuadBuffer:n}=this,{width:i,height:o,colorTl:h,colorTr:c,colorBl:f,colorBr:d,textureOptions:u,shader:T,shaderProps:_,alpha:x,clippingRect:E,tx:p,ty:g,ta:N,tb:$,tc:z,td:K,rtt:le,parentHasRenderTexture:fe,framebufferDimensions:de}=e;let{texture:A}=e;if(_&&Z(_,"$dimensions")){const m=_.$dimensions;m.width=i,m.height=o}A=A??this.defaultTexture,R(A instanceof v,"Invalid texture type");let{curBufferIdx:l,curRenderOp:L}=this;const Te={width:i,height:o},ee=T||this.defaultShader;R(ee instanceof ce),this.reuseRenderOp(e)||(this.newRenderOp(ee,_,x,Te,E,l,le,fe,de),L=this.curRenderOp,R(L));const Ee=(u==null?void 0:u.flipX)??!1,xe=(u==null?void 0:u.flipY)??!1;let I=0,M=0,S=1,y=1;if(A instanceof V){const{x:m,y:w,width:P,height:C}=A.props,{width:U=0,height:B=0}=A.parentTexture.dimensions||{width:0,height:0};I=m/U,S=I+P/U,M=w/B,y=M+C/B,A=A.parentTexture}const F=(u==null?void 0:u.resizeMode)??!1;if(A instanceof J&&F&&A.dimensions){const{width:m,height:w}=A.dimensions;if(F.type==="cover"){const P=i/m,C=o/w,U=Math.max(P,C),B=1/U;if(U&&P&&P<U){const D=B*i;I=(1-D/m)*(F.clipX??.5),S=I+D/m}if(U&&C&&C<U){const D=B*o;M=(1-D/w)*(F.clipY??.5),y=M+D/w}}}Ee&&([I,S]=[S,I]),xe&&([M,y]=[y,M]);const{txManager:_e}=this.stage,te=_e.getCtxTexture(A);R(te instanceof H);const b=this.addTexture(te,l);if(L=this.curRenderOp,R(L),$!==0||z!==0)r[l++]=p,r[l++]=g,r[l++]=I,r[l++]=M,n[l++]=h,r[l++]=b,r[l++]=p+i*N,r[l++]=g+i*z,r[l++]=S,r[l++]=M,n[l++]=c,r[l++]=b,r[l++]=p+o*$,r[l++]=g+o*K,r[l++]=I,r[l++]=y,n[l++]=f,r[l++]=b,r[l++]=p+i*N+o*$,r[l++]=g+i*z+o*K,r[l++]=S,r[l++]=y,n[l++]=d,r[l++]=b;else{const m=p+i*N,w=g+o*K;r[l++]=p,r[l++]=g,r[l++]=I,r[l++]=M,n[l++]=h,r[l++]=b,r[l++]=m,r[l++]=g,r[l++]=S,r[l++]=M,n[l++]=c,r[l++]=b,r[l++]=p,r[l++]=w,r[l++]=I,r[l++]=y,n[l++]=f,r[l++]=b,r[l++]=m,r[l++]=w,r[l++]=S,r[l++]=y,n[l++]=d,r[l++]=b}L.length+=Ke,L.numQuads++,this.curBufferIdx=l}newRenderOp(e,r,n,i,o,h,c,f,d){const u=new Be(this.glw,this.options,this.quadBufferCollection,e,r,n,o,i,h,0,c,f,d);this.curRenderOp=u,this.renderOps.push(u)}addTexture(e,r,n){const{curRenderOp:i}=this;R(i);const o=i.addTexture(e);if(o===4294967295){if(n)throw new Error("Unable to add texture to render op");const{shader:h,shaderProps:c,dimensions:f,clippingRect:d,alpha:u}=i;return this.newRenderOp(h,c,u,f,d,r),this.addTexture(e,r,!0)}return o}reuseRenderOp(e){var f;const{shader:r,shaderProps:n,parentHasRenderTexture:i,rtt:o,clippingRect:h}=e,c=r||this.defaultShader;return!(((f=this.curRenderOp)==null?void 0:f.shader)!==c||!we(this.curRenderOp.clippingRect,h)||i||o||this.curRenderOp.shader!==this.defaultShader&&(!n||!this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps,n)))}addRenderOp(e){this.renderOps.push(e),this.curRenderOp=null}render(e="screen"){const{glw:r,quadBuffer:n}=this,i=new Float32Array(n,0,this.curBufferIdx),o=this.quadBufferCollection.getBuffer("a_position")??null;r.arrayBufferData(o,i,r.STATIC_DRAW),this.renderOps.forEach((h,c)=>{h.draw()})}renderToTexture(e){for(let r=0;r<this.rttNodes.length;r++)if(this.rttNodes[r]===e)return;this.rttNodes.unshift(e)}renderRTTNodes(){const{glw:e}=this,{txManager:r}=this.stage;for(let n=0;n<this.rttNodes.length;n++){const i=this.rttNodes[n];if(!i||!i.hasRTTupdates)continue;this.activeRttNode=i,R(i.texture,"RTT node missing texture");const o=r.getCtxTexture(i.texture);R(o instanceof ae),this.renderToTextureActive=!0,e.bindFramebuffer(o.framebuffer),e.viewport(0,0,o.w,o.h),e.clear();for(let h=0;h<i.children.length;h++){const c=i.children[h];c&&(c.update(this.stage.deltaTime,{x:0,y:0,width:0,height:0,valid:!1}),this.stage.addQuads(c),c.hasRTTupdates=!1)}this.render(),this.renderOps.length=0,i.hasRTTupdates=!1}e.bindFramebuffer(null),e.viewport(0,0,this.glw.canvas.width,this.glw.canvas.height),this.renderToTextureActive=!1}removeRTTNode(e){const r=this.rttNodes.indexOf(e);r!==-1&&this.rttNodes.splice(r,1)}}const Ze={LINE_FEED:10,CARRIAGE_RETURN:13,SPACE:32,TAB:9,ZERO_WIDTH_SPACE:8203,ZERO_WIDTH_NON_JOINER:8204,ZERO_WIDTH_JOINER:8205,LEFT_TO_RIGHT_MARK:8206,RIGHT_TO_LEFT_MARK:8207,LEFT_TO_RIGHT_EMBEDDING:8234,RIGHT_TO_LEFT_EMBEDDING:8235,POP_DIRECTIONAL_FORMATTING:8236,LEFT_TO_RIGHT_OVERRIDE:8237,RIGHT_TO_LEFT_OVERRIDE:8238,LINE_SEPARATOR:8232,PARAGRAPH_SEPARATOR:8233,OBJECT_REPLACEMENT_CHARACTER:65532,REPLACEMENT_CHARACTER:65533,ZERO_WIDTH_NO_BREAK_SPACE:65279,LEFT_TO_RIGHT_ISOLATE:8294,RIGHT_TO_LEFT_ISOLATE:8295,FIRST_STRONG_ISOLATE:8296,POP_DIRECTIONAL_ISOLATE:8297,INHIBIT_SYMMETRIC_SWAPPING:8298,ACTIVATE_SYMMETRIC_SWAPPING:8299,INHIBIT_ARABIC_FORM_SHAPING:8300,ACTIVATE_ARABIC_FORM_SHAPING:8301,NATIONAL_DIGIT_SHAPES:8302,NOMINAL_DIGIT_SHAPES:8303,LEFT_TO_RIGHT_BOUNDARY:8206,RIGHT_TO_LEFT_BOUNDARY:8207};class Qe{}class je extends Qe{constructor(e,r){super();a(this,"data");a(this,"glyphMap");a(this,"kernings");this.data=e,this.glyphMap=r;const n=this.kernings={};e.kernings.forEach(i=>{const o=i.second,h=n[o]=n[o]||{};h[i.first]=i.amount}),this.kernings=n}*shapeText(e,r){var o;let n,i;for(;(n=r.peek())&&!n.done;){const h=n.value,c=this.glyphMap.get(h);if(r.next(),c!==void 0){const f=i!==void 0?(((o=this.kernings[c.id])==null?void 0:o[i])||0)+e.letterSpacing:0;i=c.id,yield{mapped:!0,glyphId:c.id,codepoint:h,cluster:r.lastIndex,xAdvance:c.xadvance+f,yAdvance:0,xOffset:c.xoffset+f,yOffset:c.yoffset,xBearing:0,yBearing:0,width:c.width,height:c.height}}else h===Ze.LINE_FEED&&(i=void 0),yield{mapped:!1,codepoint:h,cluster:r.lastIndex}}}}class Et extends Le{constructor(e,r){super(r);a(this,"type");a(this,"texture");a(this,"maxCharHeight",0);a(this,"data");a(this,"shaper");a(this,"glyphMap",new Map);const{atlasUrl:n,atlasDataUrl:i,stage:o}=r;this.type=e;const h=o.renderer;R(h instanceof qe,"SDF Font Faces can only be used with the WebGL Renderer"),this.texture=o.txManager.loadTexture("ImageTexture",{src:n,premultiplyAlpha:!1},{preload:!0}),this.texture.on("loaded",()=>{this.checkLoaded()}),fetch(i).then(async c=>{var d;this.data=await c.json(),R(this.data);let f=0;if(this.data.chars.forEach(u=>{this.glyphMap.set(u.id,u);const T=u.yoffset+u.height;T>f&&(f=T)}),this.maxCharHeight=f,this.shaper=new je(this.data,this.glyphMap),!this.metrics)if((d=this.data)!=null&&d.lightningMetrics){const{ascender:u,descender:T,lineGap:_,unitsPerEm:x}=this.data.lightningMetrics;this.metrics={ascender:u/x,descender:T/x,lineGap:_/x}}else throw new Error(`Font metrics not found in ${this.type} font ${this.fontFamily}. Make sure you are using the latest version of the Lightning 3 \`msdf-generator\` tool to generate your SDF fonts.`);this.checkLoaded()}).catch(console.error)}getAtlasEntry(e){const r=this.glyphMap.get(e);if(r===void 0)throw new Error(`Glyph ${e} not found in font ${this.fontFamily}`);return{x:r.x,y:r.y,width:r.width,height:r.height}}checkLoaded(){this.loaded||this.texture.state==="loaded"&&this.data&&(this.loaded=!0,this.emit("loaded"))}}class xt{}export{rt as A,We as B,Ie as C,he as E,J as I,j as R,Et as S,Le as T,ce as W,R as a,be as b,se as c,ot as d,ut as e,it as f,at as g,dt as h,me as i,ht as j,qe as k,ct as l,st as m,lt as n,Be as o,tt as p,xt as q,Tt as r,et as s,ft as t,v as u,Q as v,V as w,Ne as x,Pe as y,nt as z};
//# sourceMappingURL=CoreExtension-CvzE2bo0.js.map

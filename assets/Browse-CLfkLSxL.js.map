{"version":3,"file":"Browse-CLfkLSxL.js","sources":["../../src/api/key.ts","../../src/api/index.ts","../../src/api/formatters/ItemFormatter.ts","../../src/api/providers/browse.ts","../../src/components/utils/useInfiniteScroll.ts","../../src/components/ContentBlock.vue","../../src/components/Row.vue","../../src/pages/Browse.vue"],"sourcesContent":["export default 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZDE4YjEwMTA0YjdiZTlkNjFiMWYwYjVlMGEwNzM2OCIsInN1YiI6IjYwZTVjMTdlNGNhNjc2MDA3NTA4Njc3MSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.D_nqH9kd-bhhWzeVsTDPYhHnsUaNAuyAa6YATmKHqsA';\n","import API_KEY_V4 from './key';\nconst API_BASE = 'https://api.themoviedb.org/3';\nlet tmdbConfig;\nlet baseImageUrl;\nconst basePosterSize = 'w185';\n\nconst defaultFetchParams = {\n  headers: {\n    'Content-Type': 'application/json',\n    Authorization: 'Bearer ' + API_KEY_V4,\n  },\n};\n\nexport function getImageUrl(path: string, posterSize: string = basePosterSize) {\n  return baseImageUrl + posterSize + path;\n}\n\nfunction get(path: string, params: RequestInit = {}) {\n  if (tmdbConfig) {\n    return _get(path, params);\n  } else {\n    return loadConfig().then(() => _get(path, params));\n  }\n}\n\nfunction _get(path: string, params: RequestInit = {}) {\n  return fetch(API_BASE + path, {\n    ...defaultFetchParams,\n    ...params,\n  }).then((r) => r.json());\n}\n\nfunction loadConfig() {\n  return _get('/configuration').then((data) => {\n    tmdbConfig = data;\n    baseImageUrl = data.images?.secure_base_url;\n    return data;\n  });\n}\n\nexport default {\n  get,\n  loadConfig,\n};\n","import { getImageUrl } from '../index';\n\nfunction truncateString(str: string, maxLength: number): string {\n  if (str.length > maxLength) {\n    return str.substring(0, maxLength - 3) + '...';\n  }\n  return str;\n}\n\nexport function chunkArray(array: string[], size = 7) {\n  const result: string[][] = [];\n  for (let i = 0, j = array.length; i < j; i += size) {\n    result.push(array.slice(i, i + size));\n  }\n  return result;\n}\n\nexport interface Tile {\n  src: string;\n  tileSrc: string;\n  backdrop: string;\n  href: string;\n  shortTitle: string;\n  title: string;\n  data: unknown;\n  entityInfo: {\n    type: string;\n    id: string;\n  };\n  heroContent: {\n    title: string;\n    description: string;\n  };\n}\n\n// TODO: Remove `any` type\nexport function convertItemsToTiles(items: any[] = []): Tile[] {\n  return items.map((item) => ({\n    src: getImageUrl(item.poster_path || item.profile_path),\n    tileSrc: getImageUrl(item.backdrop_path || item.profile_path, 'w300'),\n    backdrop: getImageUrl(item.backdrop_path, 'w1280'),\n    href: `/entity/${item.media_type || 'people'}/${item.id}`,\n    shortTitle: truncateString(item.title || item.name, 30),\n    title: item.title || item.name,\n    data: item,\n    entityInfo: {\n      type: item.media_type || 'people',\n      id: item.id,\n    },\n    heroContent: {\n      title: item.title || item.name,\n      description: item.overview,\n    },\n  }));\n}\n","import api from '..';\nimport { convertItemsToTiles, chunkArray } from '../formatters/ItemFormatter';\n\nconst cache = new Map();\nconst leftoverTiles = new Map();\n\nexport default function (filter: string) {\n  return (pageIndex: number): Promise<any> => {\n    const url = `/trending/${filter}/week?page=${pageIndex}`;\n    if (cache.has(url)) {\n      return cache.get(url);\n    }\n\n    const result = api.get(url).then((trending) => {\n      const results = trending.results.filter((r) => !r.adult);\n      const tiles = (\n        leftoverTiles.has(filter) ? leftoverTiles.get(filter) : []\n      ).concat(convertItemsToTiles(results));\n      const chunks = chunkArray(tiles);\n      if (chunks[chunks.length - 1].length < 7) {\n        leftoverTiles.set(filter, chunks.pop());\n      } else {\n        leftoverTiles.delete(filter);\n      }\n      return chunks;\n    });\n\n    cache.set(url, result);\n    return result;\n  };\n}\n","import { ref, type Ref, watch, onMounted } from 'vue';\n\nexport function useInfiniteScroll<T>(fetcher: (page: number) => Promise<T[]>) {\n  const pages: Ref<T[]> = ref([]);\n  const page: Ref<number> = ref(1);\n  const end: Ref<boolean> = ref(false);\n\n  const fetchContent = async () => {\n    if (end.value) return;\n    const content = await fetcher(page.value);\n    if (content.length === 0) {\n      end.value = true;\n    } else {\n      pages.value = [...pages.value, ...content];\n    }\n  };\n\n  watch(page, fetchContent);\n\n  onMounted(fetchContent);\n\n  return {\n    pages,\n    page,\n    setPage: (newPage: number) => {\n      page.value = newPage;\n    },\n    end,\n    setEnd: (newEnd: boolean) => {\n      end.value = newEnd;\n    },\n  };\n}\n","<template>\n  <node id=\"contentBlock\" :style=\"ContentBlockStyle\">\n    <text :style=\"HeadlineStyles\">{{ title }}</text>\n    <text :style=\"DescriptionStyles\">{{ description }}</text>\n  </node>\n</template>\n\n<script setup lang=\"ts\">\ndefineProps({\n  title: String,\n  description: String,\n});\n\nconst blockWidth = 1200;\nconst ContentBlockStyle = {\n  display: \"flex\",\n  flexDirection: \"column\",\n  flexBoundary: \"fixed\",\n  width: blockWidth,\n  height: 220,\n  gap: 16,\n};\n\nconst HeadlineStyles = {\n  fontSize: 50,\n  fontFamily: \"Roboto\",\n  fontWeight: 700,\n  maxLines: 1,\n  width: blockWidth,\n  contain: \"width\",\n};\n\nconst DescriptionStyles = {\n  fontSize: 28,\n  fontFamily: \"Roboto\",\n  fontWeight: 400,\n  lineHeight: 32,\n  width: blockWidth,\n  maxLines: 3,\n  contain: \"width\",\n};\n</script>\n","<template>\n  <node\n    :onLeft=\"handleLeft\"\n    :onRight=\"handleRight\"\n    :forwardFocus=\"onGridFocus\"\n    :selected=\"props.selected\"\n    :onSelectedChanged=\"selectedChanged\"\n    :style=\"[style, props.style]\"\n  >\n    <slot></slot>\n  </node>\n</template>\n\n<script setup lang=\"ts\">\nimport { handleNavigation, onGridFocus } from \"./utils/handleNavigation\";\nimport { chainFunctions } from \"./utils/chainFunctions\";\nimport { withScrolling } from \"./utils/withScrolling\";\n\nconst props = defineProps({\n  selected: {\n    type: Number,\n    default: 0,\n  },\n  scrollIndex: Number,\n  onLeft: Function,\n  onRight: Function,\n  onLayout: Function,\n  onSelectedChanged: Function,\n  scroll: String,\n  style: Object,\n});\n\nconst handleLeft = chainFunctions(props.onLeft, handleNavigation(\"left\"));\nconst handleRight = chainFunctions(props.onRight, handleNavigation(\"right\"));\nconst selectedChanged = chainFunctions(\n  props.onSelectedChanged,\n  props.scroll !== \"none\" ? withScrolling(props.x) : undefined\n);\n\nconst handleLayout = (elm) => {\n  const scrollFn = withScrolling(props.x);\n  scrollFn.call(elm, elm, elm.children[elm.selected], elm.selected, undefined);\n  if (props.onLayout) props.onLayout(elm);\n};\n\nconst style = {\n  display: \"flex\",\n  flexBoundary: \"fixed\",\n  flexDirection: \"row\",\n  gap: 30,\n  transition: {\n    x: {\n      easing: \"ease-in-out\",\n      duration: 250,\n    },\n  },\n};\n</script>\n","<script setup lang=\"ts\">\nimport browseProvider from \"../api/providers/browse\";\nimport { useInfiniteScroll } from \"../components/utils/useInfiniteScroll\";\nimport ContentBlock from \"../components/ContentBlock.vue\";\nimport Row from \"../components/Row.vue\";\nimport Column from \"../components/Column.vue\";\nimport { ref, watch } from \"vue\";\nimport { ElementNode, activeElement } from \"@lightningtv/vue\";\nimport { debounce } from \"vue-debounce\";\nimport { useRouter } from \"vue-router\";\n\nconst column = ref(null);\nconst globalBackground = ref(\"\");\nconst heroContent = ref({});\nconst columnY = ref(0);\n\nconst itemsContainer = {\n  width: 1920,\n  height: 800,\n  y: 560,\n  x: 0,\n  zIndex: 2,\n};\nconst Thumbnail = {\n  borderRadius: 16,\n  width: 185,\n  height: 278,\n  scale: 1,\n  zIndex: 2,\n  transition: { scale: { duration: 250, easing: \"ease-in-out\" } },\n  border: { width: 0, color: 0x00000000 },\n  focus: { scale: 1.1, border: { color: 0xffffff66, width: 8 } },\n};\n\nconst delayedBackgrounds = debounce(\n  (img: string) => (globalBackground.value = img),\n  400\n);\nconst delayedHero = debounce(\n  (content: {}) => (heroContent.value = content || {}),\n  200\n);\n\nwatch(\n  () => activeElement.value,\n  (elm, prevFocusedElm) => {\n    if (elm && elm.item) {\n      if (elm.item.backdrop) {\n        delayedBackgrounds(elm.item.backdrop);\n      }\n\n      if (elm.item.heroContent) {\n        delayedHero(elm.item.heroContent);\n      }\n    }\n  }\n);\n\nfunction onRowFocus(this: ElementNode) {\n  this.children.selected?.setFocus();\n  columnY.value = (this.y || 0) * -1 + 24;\n  let numPages = pages.value.length;\n  this.parent!.selected = this.parent!.children.indexOf(this);\n\n  if (\n    numPages === 0 ||\n    (this.parent.selected && this.parent.selected >= numPages - 2)\n  ) {\n    page.value = page.value + 1;\n  }\n}\n\nconst router = useRouter();\nfunction onEnter(this: ElementNode, event, elm, focusedElm) {\n  if (focusedElm.item?.href) {\n    router.push(focusedElm.item.href);\n  }\n}\n\nconst { pages, page } = useInfiniteScroll(browseProvider(\"all\"));\npage.value = 1;\n</script>\n\n<template>\n  <ContentBlock\n    :y=\"360\"\n    :x=\"162\"\n    :title=\"heroContent.title\"\n    :description=\"heroContent.description\"\n  />\n  <view clipping=\"true\" :style=\"itemsContainer\">\n    <Column\n      ref=\"column\"\n      v-if=\"pages.length\"\n      :x=\"150\"\n      :y=\"columnY\"\n      :width=\"1920\"\n      :height=\"1080\"\n      :autofocus=\"true\"\n      :plinko=\"true\"\n      :onEnter=\"onEnter\"\n    >\n      <Row\n        v-for=\"row in pages\"\n        :width=\"1620\"\n        :height=\"300\"\n        :onFocus=\"onRowFocus\"\n        justifyContent=\"spaceBetween\"\n      >\n        <node\n          v-for=\"item in row\"\n          :style=\"Thumbnail\"\n          :src=\"item.src\"\n          :item=\"item\"\n        />\n      </Row>\n    </Column>\n  </view>\n</template>\n"],"names":["API_KEY_V4","API_BASE","tmdbConfig","baseImageUrl","basePosterSize","defaultFetchParams","getImageUrl","path","posterSize","get","params","_get","loadConfig","r","data","_a","api","truncateString","str","maxLength","chunkArray","array","size","result","i","j","convertItemsToTiles","items","item","cache","leftoverTiles","browseProvider","filter","pageIndex","url","trending","results","tiles","chunks","useInfiniteScroll","fetcher","pages","ref","page","end","fetchContent","content","watch","onMounted","newPage","newEnd","blockWidth","ContentBlockStyle","HeadlineStyles","DescriptionStyles","props","__props","handleLeft","chainFunctions","handleNavigation","handleRight","selectedChanged","withScrolling","style","column","globalBackground","heroContent","columnY","itemsContainer","Thumbnail","delayedBackgrounds","debounce","img","delayedHero","activeElement","elm","prevFocusedElm","onRowFocus","numPages","router","useRouter","onEnter","event","focusedElm"],"mappings":"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"}
{"version":3,"file":"Entity-B9pSSdqM.js","sources":["../../src/components/Button.vue","../../src/api/providers/entity.js","../../src/pages/Entity.vue"],"sourcesContent":["<template>\n  <node\n    v-bind=\"props\"\n    :style=\"[props.style, styles.Container.base]\"\n    :forwardStates=\"true\"\n  >\n    <text :style=\"styles.Text\"><slot></slot></text>\n  </node>\n</template>\n\n<script setup lang=\"ts\">\nimport theme from \"theme\";\nconst props = defineProps({\n  style: Object,\n});\nconst styles = {\n  Container: {\n    base: {\n      height: 92,\n      display: \"flex\",\n      padding: [50, 30],\n      color: 0xffffff1a,\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      borderRadius: 4,\n      contentColor: theme.color.fillNeutral,\n      focus: {\n        color: 0xffffffff,\n      },\n    },\n  },\n  Text: {\n    fontSize: 24,\n    color: 0xffffffff,\n    focus: {\n      color: 0x000000ff,\n    },\n  },\n};\n</script>\n","import api, { getImageUrl } from '..';\nimport { convertItemsToTiles } from '../formatters/ItemFormatter';\n\nexport function minutesToHMM(minutes) {\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return (\n    hours + 'h ' + (remainingMinutes < 10 ? '0' : '') + remainingMinutes + 'min'\n  );\n}\n\nfunction formatDate(dateString) {\n  const parts = dateString.split('-');\n  return parts[1] + '/' + parts[2] + '/' + parts[0];\n}\n\nfunction justYear(dateString) {\n  const parts = dateString.split('-');\n  return parts[0];\n}\n\nexport function getRecommendations({ type, id }) {\n  return api.get(`/${type}/${id}/recommendations`).then(({ results }) => {\n    if (results.length) {\n      return convertItemsToTiles(results.slice(0, 7));\n    }\n    return api\n      .get(`/trending/${type}/week?page=1`)\n      .then(({ results }) => convertItemsToTiles(results.slice(0, 7)));\n  });\n}\n\nexport function getCredits({ type, id }) {\n  return api\n    .get(`/${type}/${id}/credits`)\n    .then(({ cast }) => convertItemsToTiles(cast.slice(0, 7)));\n}\n\nexport function getInfo({ type, id }) {\n  let rt =\n    type === 'movie'\n      ? {\n          rtCrit: 86,\n          rtFan: 92,\n        }\n      : {};\n\n  return api.get(`/${type}/${id}`).then((data) => ({\n    backgroundImage: getImageUrl(data.backdrop_path, 'w1280'),\n    heroContent: {\n      title: data.title || data.name,\n      description: data.overview,\n      badges: ['HD', 'CC'],\n      voteAverage: data.vote_average,\n      voteCount: data.vote_count,\n      metaText:\n        type === 'movie'\n          ? minutesToHMM(data.runtime) + '   ' + formatDate(data.release_date)\n          : `${justYear(data.first_air_date)} - ${justYear(data.last_air_date)}`,\n      reviews: rt,\n    },\n    ...data,\n  }));\n}\n","<template>\n  <node v-if=\"data\">\n    <node :x=\"170\" onUp=\"focusEntity\" onEscape=\"onEscape\">\n      <ContentBlock\n        :y=\"260\"\n        :title=\"data.heroContent.title\"\n        :description=\"data.heroContent.description\"\n      ></ContentBlock>\n      <Row\n        ref=\"entityActions\"\n        :y=\"500\"\n        :height=\"90\"\n        :width=\"640\"\n        :gap=\"40\"\n        :onDown=\"focusColumn\"\n      >\n        <Button :width=\"300\" :autofocus=\"true\">Play</Button>\n        <Button :width=\"300\">Resume</Button>\n      </Row>\n\n      <Column\n        ref=\"columnRef\"\n        :x=\"0\"\n        :y=\"columnY\"\n        :style=\"styles.Column\"\n        :height=\"880\"\n        :zIndex=\"5\"\n      >\n        <template v-if=\"recommendations && credits\">\n          <text skipFocus=\"true\" :style=\"RowTitle\">Recommendations</text>\n          <Row\n            :onFocus=\"onRowFocus\"\n            :onEnter=\"onEnter\"\n            :width=\"1620\"\n            justifyContent=\"spaceBetween\"\n          >\n            <node\n              v-for=\"item in recommendations\"\n              :style=\"styles.Thumbnail\"\n              :src=\"item.src\"\n              :item=\"item\"\n            />\n          </Row>\n          <text skipFocus :style=\"RowTitle\">Cast and Crew</text>\n          <Row :onFocus=\"onRowFocusAnimate\" :onEnter=\"onEnter\" :width=\"1620\">\n            <node\n              v-for=\"item in credits\"\n              :style=\"styles.Thumbnail\"\n              :src=\"item.src\"\n              :item=\"item\"\n              justifyContent=\"spaceBetween\"\n            />\n          </Row>\n        </template>\n      </Column>\n      <node\n        ref=\"backdropRef\"\n        :style=\"Backdrop\"\n        :transition=\"{ alpha: true, y: true }\"\n      />\n    </node>\n    <node\n      :alpha=\"backdropAlpha\"\n      :color=\"0x000000FF\"\n      skipFocus\n      :zIndex=\"200\"\n      :transition=\"{ alpha: true }\"\n    />\n  </node>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, watch, watchEffect } from \"vue\";\nimport { useRoute, useRouter } from \"vue-router\";\nimport Row from \"../components/Row.vue\";\nimport Column from \"../components/Column.vue\";\nimport ContentBlock from \"../components/ContentBlock.vue\";\nimport Button from \"../components/Button.vue\";\nimport * as styles from \"../styles.js\";\nimport * as provider from \"../api/providers/entity\";\nimport { assertTruthy } from \"@lightningjs/renderer/utils\";\nimport { globalBackground } from \"../state\";\nimport type { Tile } from \"../api/formatters/ItemFormatter\";\n\nconst route = useRoute();\nconst router = useRouter();\nconst data = ref(null);\nconst credits = ref(null);\nconst recommendations = ref(null);\nconst backdropAlpha = ref(0);\n\nconst RowTitle = {\n  height: 60,\n  width: 300,\n  marginBottom: -40,\n  fontSize: 36,\n  color: 0xF0F0F0FF,\n  zIndex: 2,\n};\n\nwatchEffect(async () => {\n  data.value = await provider.getInfo(route.params);\n  credits.value = await provider.getCredits(route.params);\n  recommendations.value = await provider.getRecommendations(route.params);\n});\n\nwatch(\n  data,\n  (newData) => {\n    globalBackground.value = newData?.backgroundImage;\n  },\n  { immediate: true }\n);\n\nconst columnY = 640;\n\nconst Backdrop = {\n  color: 0x000000FF,\n  alpha: 0,\n  width: 1900,\n  height: 890,\n  x: -160,\n  y: columnY,\n  borderRadius: 30,\n};\n\nfunction onRowFocus() {\n  this.children.selected?.setFocus();\n  columnRef.value.y = columnY;\n  backdropRef.value.y = columnY;\n  backdropRef.value.alpha = 0;\n}\n\nfunction onRowFocusAnimate() {\n  this.children.selected?.setFocus();\n  columnRef.value.y = 200;\n  backdropRef.value.y = 160;\n  backdropRef.value.alpha = 0.9;\n}\n\nfunction focusColumn() {\n  columnRef.value.$el.setFocus();\n}\n\nfunction focusEntity() {\n  entityActions.value.$el.setFocus();\n}\n\nfunction onEnter() {\n  const entity = this.children.find((c) => c.states!.has(\"focus\"));\n  assertTruthy(entity && entity.href);\n  router.push(entity.href);\n}\n\nlet columnRef = ref(null);\nlet backdropRef = ref(null);\nlet entityActions = ref(null);\n</script>\n"],"names":["props","__props","styles","theme","minutesToHMM","minutes","hours","remainingMinutes","formatDate","dateString","parts","justYear","getRecommendations","type","id","api","results","convertItemsToTiles","getCredits","cast","getInfo","rt","data","getImageUrl","columnY","route","useRoute","router","useRouter","ref","credits","recommendations","backdropAlpha","RowTitle","watchEffect","provider.getInfo","provider.getCredits","provider.getRecommendations","watch","newData","globalBackground","Backdrop","onRowFocus","_a","columnRef","backdropRef","onRowFocusAnimate","focusColumn","onEnter","entity","c","assertTruthy","entityActions"],"mappings":"2VAYA,MAAMA,EAAQC,EAGRC,EAAS,CACb,UAAW,CACT,KAAM,CACJ,OAAQ,GACR,QAAS,OACT,QAAS,CAAC,GAAI,EAAE,EAChB,MAAO,WACP,eAAgB,SAChB,WAAY,SACZ,aAAc,EACd,aAAcC,EAAM,MAAM,YAC1B,MAAO,CACL,MAAO,UACT,CACF,CACF,EACA,KAAM,CACJ,SAAU,GACV,MAAO,WACP,MAAO,CACL,MAAO,GACT,CACF,CAAA,sJClCK,SAASC,EAAaC,EAAS,CACpC,MAAMC,EAAQ,KAAK,MAAMD,EAAU,EAAE,EAC/BE,EAAmBF,EAAU,GACnC,OACEC,EAAQ,MAAQC,EAAmB,GAAK,IAAM,IAAMA,EAAmB,KAE3E,CAEA,SAASC,EAAWC,EAAY,CAC9B,MAAMC,EAAQD,EAAW,MAAM,GAAG,EAClC,OAAOC,EAAM,CAAC,EAAI,IAAMA,EAAM,CAAC,EAAI,IAAMA,EAAM,CAAC,CAClD,CAEA,SAASC,EAASF,EAAY,CAE5B,OADcA,EAAW,MAAM,GAAG,EACrB,CAAC,CAChB,CAEO,SAASG,EAAmB,CAAE,KAAAC,EAAM,GAAAC,GAAM,CAC/C,OAAOC,EAAI,IAAI,IAAIF,CAAI,IAAIC,CAAE,kBAAkB,EAAE,KAAK,CAAC,CAAE,QAAAE,CAAO,IAC1DA,EAAQ,OACHC,EAAoBD,EAAQ,MAAM,EAAG,CAAC,CAAC,EAEzCD,EACJ,IAAI,aAAaF,CAAI,cAAc,EACnC,KAAK,CAAC,CAAE,QAAAG,CAAO,IAAOC,EAAoBD,EAAQ,MAAM,EAAG,CAAC,CAAC,CAAC,CAClE,CACH,CAEO,SAASE,GAAW,CAAE,KAAAL,EAAM,GAAAC,GAAM,CACvC,OAAOC,EACJ,IAAI,IAAIF,CAAI,IAAIC,CAAE,UAAU,EAC5B,KAAK,CAAC,CAAE,KAAAK,CAAI,IAAOF,EAAoBE,EAAK,MAAM,EAAG,CAAC,CAAC,CAAC,CAC7D,CAEO,SAASC,GAAQ,CAAE,KAAAP,EAAM,GAAAC,GAAM,CACpC,IAAIO,EACFR,IAAS,QACL,CACE,OAAQ,GACR,MAAO,EACR,EACD,GAEN,OAAOE,EAAI,IAAI,IAAIF,CAAI,IAAIC,CAAE,EAAE,EAAE,KAAMQ,IAAU,CAC/C,gBAAiBC,EAAYD,EAAK,cAAe,OAAO,EACxD,YAAa,CACX,MAAOA,EAAK,OAASA,EAAK,KAC1B,YAAaA,EAAK,SAClB,OAAQ,CAAC,KAAM,IAAI,EACnB,YAAaA,EAAK,aAClB,UAAWA,EAAK,WAChB,SACET,IAAS,QACLT,EAAakB,EAAK,OAAO,EAAI,MAAQd,EAAWc,EAAK,YAAY,EACjE,GAAGX,EAASW,EAAK,cAAc,CAAC,MAAMX,EAASW,EAAK,aAAa,CAAC,GACxE,QAASD,CACV,EACD,GAAGC,CACJ,EAAC,CACJ,qHCmDME,EAAU,mCA9BhB,MAAMC,EAAQC,IACRC,EAASC,IACTN,EAAOO,EAAI,IAAI,EACfC,EAAUD,EAAI,IAAI,EAClBE,EAAkBF,EAAI,IAAI,EAC1BG,EAAgBH,EAAI,CAAC,EAErBI,EAAW,CACf,OAAQ,GACR,MAAO,IACP,aAAc,IACd,SAAU,GACV,MAAO,WACP,OAAQ,CAAA,EAGVC,EAAY,SAAY,CACtBZ,EAAK,MAAQ,MAAMa,GAAiBV,EAAM,MAAM,EAChDK,EAAQ,MAAQ,MAAMM,GAAoBX,EAAM,MAAM,EACtDM,EAAgB,MAAQ,MAAMM,EAA4BZ,EAAM,MAAM,CAAA,CACvE,EAEDa,EACEhB,EACCiB,GAAY,CACXC,EAAiB,MAAQD,GAAA,YAAAA,EAAS,eACpC,EACA,CAAE,UAAW,EAAK,CAAA,EAKpB,MAAME,EAAW,CACf,MAAO,IACP,MAAO,EACP,MAAO,KACP,OAAQ,IACR,EAAG,KACH,EAAGjB,EACH,aAAc,EAAA,EAGhB,SAASkB,GAAa,QACfC,EAAA,KAAA,SAAS,WAAT,MAAAA,EAAmB,WACxBC,EAAU,MAAM,EAAIpB,EACpBqB,EAAY,MAAM,EAAIrB,EACtBqB,EAAY,MAAM,MAAQ,CAC5B,CAEA,SAASC,GAAoB,QACtBH,EAAA,KAAA,SAAS,WAAT,MAAAA,EAAmB,WACxBC,EAAU,MAAM,EAAI,IACpBC,EAAY,MAAM,EAAI,IACtBA,EAAY,MAAM,MAAQ,EAC5B,CAEA,SAASE,GAAc,CACXH,EAAA,MAAM,IAAI,UACtB,CAMA,SAASI,GAAU,CACX,MAAAC,EAAS,KAAK,SAAS,KAAMC,GAAMA,EAAE,OAAQ,IAAI,OAAO,CAAC,EAClDC,EAAAF,GAAUA,EAAO,IAAI,EAC3BtB,EAAA,KAAKsB,EAAO,IAAI,CACzB,CAEI,IAAAL,EAAYf,EAAI,IAAI,EACpBgB,EAAchB,EAAI,IAAI,EACtBuB,EAAgBvB,EAAI,IAAI"}